<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

  const SUPABASE_URL = "https://yaiutswdcbfwkxfqxkzy.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhaXV0c3dkY2Jmd2t4ZnF4a3p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDE2MDgsImV4cCI6MjA4MDA3NzYwOH0.HOLFxzjsZ5Ieqg0b-aTdP0hAdLsPVXL6Zjs-HgOHgc8";
  const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const emailEl = document.getElementById("email");
  const btn = document.getElementById("btnSend");
  const msg = document.getElementById("msg");

  function setMsg(text, ok=false){
    if (!msg) return;
    msg.textContent = text || "";
    msg.style.color = ok ? "#0f7b46" : "#b3261e";
    msg.style.fontWeight = "800";
  }

  btn.addEventListener("click", async () => {
    try{
      const email = (emailEl.value || "").trim().toLowerCase();
      if (!email || !email.includes("@")) throw new Error("Enter a valid email.");

      btn.disabled = true;
      setMsg("Sending secure linkâ€¦", true);

      const emailRedirectTo = new URL("client-secure-dashboard.html", location.origin).toString();

      const { error } = await sb.auth.signInWithOtp({
        email,
        options: { emailRedirectTo }
      });

      if (error) throw error;

      setMsg("Link sent. Check inbox/spam.", true);
    } catch(err){
      console.error("[TBP] customer-login error:", err);
      setMsg(err?.message || "Failed to send link.");
    } finally {
      btn.disabled = false;
    }
  });
</script>
</body>
</html>

</body>
</html>
