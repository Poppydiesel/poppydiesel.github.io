<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TradeBotPro — Tell us about your business</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="TradeBotPro signup — tell us about your trade business so we can set up your AI office assistant."
  />

  <style>
    :root {
      --primary-blue: #1f4e79;
      --accent-blue: #00a3ff;
      --dark-text: #1b1b1f;
      --light-bg: #f5f7fa;
      --white: #ffffff;
      --border-radius-lg: 16px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--light-bg);
      color: var(--dark-text);
      line-height: 1.6;
    }

    a {
      color: var(--accent-blue);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 16px 24px;
      background: var(--white);
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #dde3ee;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--primary-blue);
    }

    .logo-mark {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      background: var(--primary-blue);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 0.9rem;
      font-weight: 700;
    }

    .layout {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.1fr);
      gap: 32px;
      padding: 24px;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .hero {
      padding-right: 16px;
    }

    .hero h1 {
      font-size: 2rem;
      margin: 0 0 8px;
      color: var(--primary-blue);
    }

    .hero p.lead {
      margin: 0 0 16px;
      font-size: 1rem;
      color: #4a4f5b;
    }

    .hero-list {
      margin: 16px 0 0;
      padding-left: 18px;
      color: #3a3f48;
      font-size: 0.95rem;
    }

    .hero-list li {
      margin-bottom: 6px;
    }

    /* Card / form container */
    .card {
      background: var(--white);
      border-radius: var(--border-radius-lg);
      padding: 24px 20px;
      box-shadow: 0 14px 35px rgba(15, 23, 42, 0.08);
      border: 1px solid #dde3ee;
    }

    .card h2 {
      margin: 0 0 8px;
      font-size: 1.3rem;
      color: var(--primary-blue);
    }

    .card p.sub {
      margin: 0 0 16px;
      font-size: 0.9rem;
      color: #5a6270;
    }

    /* Progress bar */
    .progress {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      gap: 8px;
      font-size: 0.8rem;
      color: #6b7280;
    }

    .progress-steps {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
    }

    .progress-step {
      position: relative;
      height: 6px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .progress-step-fill {
      position: absolute;
      inset: 0;
      width: 0%;
      background: linear-gradient(90deg, var(--primary-blue), var(--accent-blue));
      transition: width 0.25s ease;
    }

    .progress-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 4px;
      font-size: 0.72rem;
    }

    .progress-labels span {
      color: #9ca3af;
    }

    .progress-labels span.active {
      color: var(--primary-blue);
      font-weight: 600;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 16px;
      font-size: 0.9rem;
    }

    .step {
      display: none;
    }

    .step.active {
      display: block;
    }

    .field-group {
      display: grid;
      grid-template-columns: 1.1fr 1.1fr;
      gap: 12px;
    }

    @media (max-width: 600px) {
      .field-group {
        grid-template-columns: 1fr;
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 0.82rem;
      font-weight: 600;
      color: #374151;
    }

    label span.optional {
      font-weight: 400;
      color: #9ca3af;
      font-size: 0.78rem;
      margin-left: 4px;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="number"],
    textarea,
    select {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 9px 12px;
      font-size: 0.9rem;
      font-family: inherit;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
      background: #f9fafb;
    }

    textarea {
      border-radius: 12px;
      min-height: 70px;
      resize: vertical;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 1px rgba(0, 163, 255, 0.3);
      background: #ffffff;
    }

    .hint {
      font-size: 0.75rem;
      color: #6b7280;
    }

    .inline-hint {
      font-size: 0.78rem;
      color: #6b7280;
      margin-top: 4px;
    }

    .step-title {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 4px;
      color: #111827;
    }

    .step-sub {
      font-size: 0.8rem;
      color: #6b7280;
      margin-bottom: 12px;
    }

    .button-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 4px;
    }

    .button-spacer {
      flex: 1;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 9px 16px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background 0.15s ease, transform 0.07s ease, box-shadow 0.15s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
      color: #ffffff;
      box-shadow: 0 10px 18px rgba(15, 23, 42, 0.25);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 24px rgba(15, 23, 42, 0.32);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 8px 14px rgba(15, 23, 42, 0.22);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }

    .btn-secondary:hover {
      background: #d1d5db;
    }

    .status {
      font-size: 0.8rem;
      margin-top: 6px;
      min-height: 18px;
    }

    .status.ok {
      color: #16a34a;
    }

    .status.error {
      color: #b91c1c;
    }

    .status.info {
      color: #4b5563;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 0.75rem;
      background: #f9fafb;
      cursor: pointer;
    }

    .pill.active {
      border-color: var(--accent-blue);
      background: rgba(0, 163, 255, 0.06);
      color: var(--primary-blue);
      font-weight: 600;
    }

    .footer-note {
      margin-top: 10px;
      font-size: 0.75rem;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="logo">
        <div class="logo-mark">TB</div>
        <span>TradeBotPro</span>
      </div>
      <div style="font-size:0.82rem;color:#6b7280;">
        More jobs. Less admin. <span style="color:var(--primary-blue);font-weight:600;">Powered by AI.</span>
      </div>
    </header>

    <main class="layout">
      <section class="hero">
        <h1>Tell us about your business</h1>
        <p class="lead">
          Answer a few quick questions and we’ll use this to set up your
          <strong>24/7 AI office assistant</strong> for your trade business.
        </p>
        <ul class="hero-list">
          <li>We’ll configure how your AI answers, books jobs and prices work.</li>
          <li>No payment taken yet — we’ll follow up to confirm everything with you.</li>
          <li>You can change any of this later; this just gives us a head start.</li>
        </ul>
      </section>

      <section class="card">
        <h2>Get your AI office set up</h2>
        <p class="sub">Takes about 2–3 minutes. You can keep it simple — bullet points are fine.</p>

        <!-- Progress bar -->
        <div class="progress" aria-hidden="true">
          <div class="progress-steps">
            <div class="progress-step">
              <div class="progress-step-fill" data-step-fill="1"></div>
            </div>
            <div class="progress-step">
              <div class="progress-step-fill" data-step-fill="2"></div>
            </div>
            <div class="progress-step">
              <div class="progress-step-fill" data-step-fill="3"></div>
            </div>
          </div>
        </div>
        <div class="progress-labels">
          <span data-step-label="1" class="active">Your details</span>
          <span data-step-label="2">How you price</span>
          <span data-step-label="3">AI office focus</span>
        </div>

        <form id="tradebotpro-signup-form">
          <!-- STEP 1: Business basics -->
          <div class="step active" data-step="1">
            <div class="step-title">Step 1 — About your business</div>
            <div class="step-sub">Tell us who you are and how customers reach you.</div>

            <div class="field-group">
              <div class="field">
                <label for="business_name">Business name</label>
                <input id="business_name" name="business_name" type="text" autocomplete="organization" required />
              </div>
              <div class="field">
                <label for="owner_name">
                  Your name
                  <span class="optional">(who we should speak to)</span>
                </label>
                <input id="owner_name" name="owner_name" type="text" autocomplete="name" required />
              </div>
            </div>

            <div class="field-group">
              <div class="field">
                <label for="email">Best email</label>
                <input id="email" name="email" type="email" autocomplete="email" required />
                <div class="inline-hint">We’ll send your setup summary here.</div>
              </div>
              <div class="field">
                <label for="phone">
                  Main phone number
                  <span class="optional">(mobile or office)</span>
                </label>
                <input id="phone" name="phone" type="tel" autocomplete="tel" required />
              </div>
            </div>

            <div class="field-group">
              <div class="field">
                <label for="whatsapp_number">
                  WhatsApp number
                  <span class="optional">(if different)</span>
                </label>
                <input id="whatsapp_number" name="whatsapp_number" type="tel" autocomplete="tel" />
                <div class="inline-hint">This is where your AI office can chat with customers.</div>
              </div>
              <div class="field">
                <label for="trade_type">What trade are you?</label>
                <select id="trade_type" name="trade_type" required>
                  <option value="">Select your main trade…</option>
                  <option value="Plumbing & Heating">Plumbing &amp; Heating</option>
                  <option value="Gas & Boilers">Gas &amp; Boilers</option>
                  <option value="Electrical">Electrical</option>
                  <option value="Landscaping & Fencing">Landscaping &amp; Fencing</option>
                  <option value="Roofing">Roofing</option>
                  <option value="Joinery / Carpentry">Joinery / Carpentry</option>
                  <option value="Handyman / Small works">Handyman / Small works</option>
                  <option value="Other">Other</option>
                </select>
              </div>
            </div>

            <div class="field-group">
              <div class="field">
                <label for="base_postcode">
                  Base postcode
                  <span class="optional">(where you work from)</span>
                </label>
                <input id="base_postcode" name="base_postcode" type="text" placeholder="e.g. HP14 3QF" required />
              </div>
              <div class="field">
                <label for="service_radius">
                  How far do you travel? (miles)
                </label>
                <input id="service_radius" name="service_radius" type="number" min="1" max="100" placeholder="e.g. 15" />
                <div class="inline-hint">Rough radius from your base postcode is fine.</div>
              </div>
            </div>

            <div class="field">
              <label for="website_url">
                Website
                <span class="optional">(if you have one)</span>
              </label>
              <input id="website_url" name="website_url" type="text" placeholder="https://yourwebsite.co.uk" />
            </div>

            <div class="button-row">
              <div class="button-spacer"></div>
              <button type="button" class="btn-primary" data-next-step="2">
                Next: How you price →
              </button>
            </div>
          </div>

          <!-- STEP 2: Pricing basics -->
          <div class="step" data-step="2">
            <div class="step-title">Step 2 — How you charge for work</div>
            <div class="step-sub">
              We’ll use this to stop the AI giving silly prices and keep everything within your rules.
            </div>

            <div class="field-group">
              <div class="field">
                <label for="callout_fee">
                  Typical call-out fee
                  <span class="optional">(£)</span>
                </label>
                <input id="callout_fee" name="callout_fee" type="number" min="0" step="1" placeholder="e.g. 60" />
              </div>
              <div class="field">
                <label for="first_hour_rate">
                  First hour rate
                  <span class="optional">(£)</span>
                </label>
                <input id="first_hour_rate" name="first_hour_rate" type="number" min="0" step="1" placeholder="e.g. 90" />
              </div>
            </div>

            <div class="field-group">
              <div class="field">
                <label for="hourly_rate">
                  Hourly rate after first hour
                  <span class="optional">(£)</span>
                </label>
                <input id="hourly_rate" name="hourly_rate" type="number" min="0" step="1" placeholder="e.g. 70" />
              </div>
              <div class="field">
                <label for="quote_minimum">
                  Minimum job value
                  <span class="optional">(£)</span>
                </label>
                <input id="quote_minimum" name="quote_minimum" type="number" min="0" step="1" placeholder="e.g. 120" />
              </div>
            </div>

            <div class="field">
              <label for="pricing_notes">
                Anything we should know about your pricing?
                <span class="optional">(optional)</span>
              </label>
              <textarea
                id="pricing_notes"
                name="pricing_notes"
                placeholder="E.g. No free call-outs, boiler services Mon–Thu only, fixed prices for certain jobs, OOH rates etc."
              ></textarea>
            </div>

            <div class="button-row">
              <button type="button" class="btn-secondary" data-prev-step="1">← Back</button>
              <button type="button" class="btn-primary" data-next-step="3">
                Next: AI office focus →
              </button>
            </div>
          </div>

          <!-- STEP 3: AI focus & style -->
          <div class="step" data-step="3">
            <div class="step-title">Step 3 — What should your AI office focus on first?</div>
            <div class="step-sub">
              This guides how we configure your assistant on day one.
              <br />
              Choose a main focus and add a few bullet points so we get it right.
            </div>

            <div class="field">
              <label>
                Pick 1–3 main priorities
                <span class="optional">(tap to toggle)</span>
              </label>
              <div class="pill-row" id="focus-pills">
                <button type="button" class="pill" data-focus="More booked jobs">
                  More booked jobs
                </button>
                <button type="button" class="pill" data-focus="Faster response to messages">
                  Faster response to messages
                </button>
                <button type="button" class="pill" data-focus="Filter time-wasters & small jobs">
                  Filter time-wasters &amp; small jobs
                </button>
                <button type="button" class="pill" data-focus="Better-quality enquiries">
                  Better-quality enquiries
                </button>
                <button type="button" class="pill" data-focus="Chasing quotes & follow-ups">
                  Chasing quotes &amp; follow-ups
                </button>
                <button type="button" class="pill" data-focus="Out-of-hours cover">
                  Out-of-hours cover
                </button>
              </div>
              <!-- Hidden field we submit -->
              <input type="hidden" id="services_summary" name="services_summary" />
              <div class="inline-hint">
                We’ll save this as a short “focus summary” for your AI office.
              </div>
            </div>

            <div class="field">
              <label for="ai_style_notes">
                How should your AI office sound & behave?
                <span class="optional">(optional but recommended)</span>
              </label>
              <textarea
                id="ai_style_notes"
                name="ai_style_notes"
                placeholder="E.g. Friendly but professional, use simple language, always try to get photos & postcode, never discount without asking me, etc."
              ></textarea>
              <div class="inline-hint">
                You can include any do’s and don’ts – tone of voice, questions to always ask, things never to promise.
              </div>
            </div>

            <div class="field">
              <label for="callout_notes">
                Anything else we should know?
                <span class="optional">(optional)</span>
              </label>
              <textarea
                id="callout_notes"
                name="callout_notes"
                placeholder="E.g. Areas you avoid, job types you don’t want, special services you offer, how you like your diary managed."
              ></textarea>
            </div>

            <div class="button-row">
              <button type="button" class="btn-secondary" data-prev-step="2">← Back</button>
              <button type="submit" class="btn-primary">
                Submit details &amp; start setup
              </button>
            </div>

            <div id="form-status" class="status info"></div>
            <div class="footer-note">
              By submitting, you agree to us contacting you about setting up TradeBotPro for your business.
            </div>
          </div>
        </form>
      </section>
    </main>
  </div>

  <!-- Supabase + form logic -->
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    // TODO: Replace with your real Supabase URL and anon key
    const SUPABASE_URL = "https://yaiutswdcbfwkxfqxkzy.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhaXV0c3dkY2Jmd2t4ZnF4a3p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDE2MDgsImV4cCI6MjA4MDA3NzYwOH0.HOLFxzjsZ5Ieqg0b-aTdP0hAdLsPVXL6Zjs-HgOHgc8";


    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ----- Progress / steps -----
    const steps = Array.from(document.querySelectorAll('.step'));
    const stepLabels = document.querySelectorAll('[data-step-label]');
    const progressFills = document.querySelectorAll('[data-step-fill]');
    let currentStep = 1;

    function updateProgress() {
      steps.forEach((step) => {
        const stepNum = Number(step.getAttribute('data-step'));
        step.classList.toggle('active', stepNum === currentStep);
      });

      stepLabels.forEach((label) => {
        const stepNum = Number(label.getAttribute('data-step-label'));
        label.classList.toggle('active', stepNum === currentStep);
      });

      progressFills.forEach((fill) => {
        const stepNum = Number(fill.getAttribute('data-step-fill'));
        if (stepNum < currentStep) {
          fill.style.width = '100%';
        } else if (stepNum === currentStep) {
          fill.style.width = '100%';
        } else {
          fill.style.width = '0%';
        }
      });
    }

    document.querySelectorAll('[data-next-step]').forEach((btn) => {
      btn.addEventListener('click', () => {
        const target = Number(btn.getAttribute('data-next-step'));
        currentStep = target;
        updateProgress();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    });

    document.querySelectorAll('[data-prev-step]').forEach((btn) => {
      btn.addEventListener('click', () => {
        const target = Number(btn.getAttribute('data-prev-step'));
        currentStep = target;
        updateProgress();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    });

    updateProgress();

    // ----- Focus pills -> services_summary -----
    const pillContainer = document.getElementById('focus-pills');
    const servicesSummaryInput = document.getElementById('services_summary');

    if (pillContainer) {
      pillContainer.addEventListener('click', (e) => {
        const pill = e.target.closest('.pill');
        if (!pill) return;
        pill.classList.toggle('active');

        const activePills = Array.from(
          pillContainer.querySelectorAll('.pill.active')
        ).map((p) => p.getAttribute('data-focus'));

        servicesSummaryInput.value = activePills.join(', ');
      });
    }

    // ----- Form submit -> Supabase -----
    const form = document.getElementById('tradebotpro-signup-form');
    const statusEl = document.getElementById('form-status');

    function setStatus(message, type = 'info') {
      if (!statusEl) return;
      statusEl.textContent = message;
      statusEl.classList.remove('ok', 'error', 'info');
      statusEl.classList.add(type);
    }

    if (form) {
      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        setStatus('Submitting your details…', 'info');

        const formData = new FormData(form);

        const payload = {
          business_name: formData.get('business_name')?.toString().trim() || null,
          owner_name: formData.get('owner_name')?.toString().trim() || null,
          email: formData.get('email')?.toString().trim() || null,
          phone: formData.get('phone')?.toString().trim() || null,
          whatsapp_number: formData.get('whatsapp_number')?.toString().trim() || null,
          trade_type: formData.get('trade_type')?.toString().trim() || null,
          base_postcode: formData.get('base_postcode')?.toString().trim().toUpperCase() || null,
          service_radius: formData.get('service_radius')
            ? Number(formData.get('service_radius'))
            : null,
          website_url: formData.get('website_url')?.toString().trim() || null,

          callout_fee: formData.get('callout_fee')
            ? Number(formData.get('callout_fee'))
            : null,
          first_hour_rate: formData.get('first_hour_rate')
            ? Number(formData.get('first_hour_rate'))
            : null,
          hourly_rate: formData.get('hourly_rate')
            ? Number(formData.get('hourly_rate'))
            : null,
          quote_minimum: formData.get('quote_minimum')
            ? Number(formData.get('quote_minimum'))
            : null,
          pricing_notes: formData.get('pricing_notes')?.toString().trim() || null,

          services_summary: formData.get('services_summary')?.toString().trim() || null,
          ai_style_notes: formData.get('ai_style_notes')?.toString().trim() || null,
          callout_notes: formData.get('callout_notes')?.toString().trim() || null,

          // sensible defaults for our workflow
          plan_status: 'Onboarding',
          pending_setup: true,
          account_status: 'Pending',
          account_status_reason: null
        };

        try {
          const { error } = await supabase
            .from('tradebotpro_signups')
            .insert(payload);

          if (error) {
            console.error('Supabase insert error:', error);
            setStatus(
              'Something went wrong saving your details. Please try again or contact us.',
              'error'
            );
            return;
          }

          setStatus('Thanks — your details have been sent. We’ll be in touch shortly.', 'ok');
          form.reset();
          servicesSummaryInput.value = '';
          pillContainer?.querySelectorAll('.pill.active')?.forEach((p) =>
            p.classList.remove('active')
          );
          currentStep = 1;
          updateProgress();
        } catch (err) {
          console.error('Unexpected error:', err);
          setStatus(
            'Unexpected error while submitting. Please refresh the page and try again.',
            'error'
          );
        }
      });
    }
  </script>
</body>
</html>
