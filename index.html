<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TradeBotPro — Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --blue:#1f4e79;
  --blue-soft:#e8f1fb;
  --bg:#f5f7fa;
  --card:#ffffff;
  --border:#d1d5db;
  --text:#1b1b1f;
  --muted:#6b7280;
}
*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  background:#fff;
  border-bottom:1px solid var(--border);
  padding:14px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

header h1{
  margin:0;
  font-size:18px;
}

header span{
  font-size:12px;
  color:var(--muted);
}

main{
  max-width:1400px;
  margin:20px auto;
  padding:0 16px;
  display:grid;
  grid-template-columns:2.2fr 1.4fr;
  gap:16px;
}

.card{
  background:var(--card);
  border-radius:12px;
  border:1px solid var(--border);
  padding:14px;
}

/* TABLE */
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{
  padding:10px;
  border-bottom:1px solid #e5e7eb;
  text-align:left;
}
th{
  font-size:11px;
  color:var(--muted);
  text-transform:uppercase;
}
tbody tr{
  cursor:pointer;
}
tbody tr:hover{
  background:#f9fafb;
}
tbody tr.selected{
  background:var(--blue-soft);
  box-shadow:inset 4px 0 0 var(--blue);
}

/* STATUS */
.status{
  font-size:11px;
  padding:3px 8px;
  border-radius:999px;
  background:#eef2ff;
  color:var(--blue);
}

/* RIGHT PANEL */
h3{
  margin:0 0 8px 0;
  font-size:14px;
}

.small{
  font-size:12px;
  color:var(--muted);
}

label{
  font-size:11px;
  color:var(--muted);
}

select,textarea{
  width:100%;
  margin-top:4px;
  margin-bottom:8px;
  padding:6px 8px;
  font-size:13px;
  border-radius:8px;
  border:1px solid var(--border);
  font-family:inherit;
}

textarea{min-height:120px}

button{
  border:none;
  border-radius:999px;
  padding:8px 14px;
  font-size:12px;
  cursor:pointer;
  background:var(--blue);
  color:#fff;
}
button.secondary{
  background:#e5e7eb;
  color:#111;
}

.selected-banner{
  background:var(--blue-soft);
  border:1px solid #c7ddf4;
  padding:8px 10px;
  border-radius:8px;
  font-size:13px;
  margin-bottom:10px;
}
</style>
</head>

<body>

<header>
  <h1>TradeBotPro Admin</h1>
  <span>Internal · COPY-ONLY messages</span>
</header>

<main>

  <!-- LEFT -->
  <div class="card">
    <h3>Signups</h3>
    <table>
      <thead>
        <tr>
          <th>Business</th>
          <th>Contact</th>
          <th>Postcode</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="rows">
        <tr><td colspan="4" class="small">Loading…</td></tr>
      </tbody>
    </table>
  </div>

  <!-- RIGHT -->
  <div class="card">
    <h3>Messaging</h3>

    <div id="selectedInfo" class="selected-banner small">
      No customer selected
    </div>

    <label for="templateSelect">Template</label>
    <select id="templateSelect" aria-label="Message template">
      <option value="">— choose —</option>
      <option value="welcome">Welcome / next steps</option>
      <option value="onboarding">Book onboarding call</option>
      <option value="live">You’re now live</option>
      <option value="pause">Account paused</option>
    </select>

    <label for="messageBox">Message (copy only)</label>
    <textarea id="messageBox"
      aria-label="Message body"
      placeholder="Choose a template or write freely…"></textarea>

    <button onclick="copyMessage()">Copy message</button>
  </div>

</main>

<script src="https://esm.sh/@supabase/supabase-js@2"></script>
<script>
/* ⛔ CHANGE ONLY THESE TWO LINES */
 const SUPABASE_URL = "https://yaiutswdcbfwkxfqxkzy.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhaXV0c3dkY2Jmd2t4ZnF4a3p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDE2MDgsImV4cCI6MjA4MDA3NzYwOH0.HOLFxzjsZ5Ieqg0b-aTdP0hAdLsPVXL6Zjs-HgOHgc8";

const supabase = supabaseJs.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let allRows = [];
let selected = null;

const rowsEl = document.getElementById('rows');
const selectedInfo = document.getElementById('selectedInfo');
const templateSelect = document.getElementById('templateSelect');
const messageBox = document.getElementById('messageBox');

async function load(){
  const { data, error } = await supabase
    .from('tradebotpro_signups')
    .select('*')
    .order('created_at', { ascending:false });

  if(error){
    rowsEl.innerHTML='<tr><td colspan="4">Error loading</td></tr>';
    return;
  }
  allRows=data;
  render();
}

function render(){
  rowsEl.innerHTML='';
  allRows.forEach(r=>{
    const tr=document.createElement('tr');
    tr.dataset.id=r.id;
    if(selected && selected.id===r.id) tr.classList.add('selected');
    tr.innerHTML=`
      <td><strong>${r.business_name||''}</strong></td>
      <td>${r.contact_name||r.owner_name||''}</td>
      <td>${r.base_postcode||''}</td>
      <td><span class="status">${r.account_status||r.plan_status||''}</span></td>
    `;
    tr.onclick=()=>selectRow(r);
    rowsEl.appendChild(tr);
  });
}

function selectRow(r){
  selected=r;
  selectedInfo.textContent=`Selected: ${r.business_name}`;
  document.querySelectorAll('tr').forEach(tr=>tr.classList.remove('selected'));
  const row=[...rowsEl.children].find(x=>x.dataset.id==r.id);
  if(row) row.classList.add('selected');
  templateSelect.value='';
  messageBox.value='';
}

templateSelect.onchange=()=>{
  if(!selected){
    alert('Select a customer first');
    templateSelect.value='';
    return;
  }
  const name=selected.contact_name||selected.owner_name||'there';
  const biz=selected.business_name||'your business';
  switch(templateSelect.value){
    case 'welcome':
      messageBox.value=`Hi ${name}, thanks for signing up to TradeBotPro.\n\nNext step is a quick onboarding call so we tailor the assistant properly for ${biz}.`;
      break;
    case 'onboarding':
      messageBox.value=`Hi ${name}, can we book a short onboarding call to finish setting TradeBotPro up for ${biz}?`;
      break;
    case 'live':
      messageBox.value=`Hi ${name}, your TradeBotPro AI office for ${biz} is now live ✅`;
      break;
    case 'pause':
      messageBox.value=`Hi ${name}, we’ve paused TradeBotPro for now. Nothing is deleted — just message when ready to resume.`;
      break;
  }
};

function copyMessage(){
  if(!messageBox.value){
    alert('Nothing to copy');
    return;
  }
  navigator.clipboard.writeText(messageBox.value);
  alert('Copied to clipboard');
}

load();
</script>

</body>
</html>
