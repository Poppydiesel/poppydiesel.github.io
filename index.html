<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TradeBotPro — Get your AI office set up</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="Sign up to TradeBotPro and let us build your AI office assistant for your trade business."
  />

  <style>
    :root {
      --primary-blue: #1f4e79;
      --accent-blue: #00a3ff;
      --dark-text: #1b1b1f;
      --light-bg: #f5f7fa;
      --white: #ffffff;
      --border-grey: #d0d4dd;
      --muted: #6b7280;
      --error: #b91c1c;
      --success: #15803d;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--light-bg);
      color: var(--dark-text);
      line-height: 1.6;
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: var(--white);
      border-bottom: 1px solid var(--border-grey);
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    header .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    header .logo-circle {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: var(--primary-blue);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--white);
      font-weight: 700;
      font-size: 16px;
    }

    header .brand-text {
      display: flex;
      flex-direction: column;
    }

    header .brand-text span:first-child {
      font-weight: 600;
      font-size: 15px;
    }

    header .brand-text span:last-child {
      font-size: 12px;
      color: var(--muted);
    }

    main {
      flex: 1;
      display: flex;
      justify-content: center;
      padding: 32px 16px 48px;
    }

    .shell {
      width: 100%;
      max-width: 880px;
      background: var(--white);
      border-radius: 16px;
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.1);
      padding: 24px 24px 28px;
    }

    @media (min-width: 768px) {
      .shell {
        padding: 32px 32px 36px;
      }
    }

    .shell-header {
      margin-bottom: 24px;
    }

    .shell-header h1 {
      margin: 0 0 4px;
      font-size: 22px;
    }

    .shell-header p {
      margin: 0;
      font-size: 14px;
      color: var(--muted);
    }

    /* Progress bar */

    .progress {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 24px;
    }

    .progress-label-row {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--muted);
    }

    .progress-label-row span.current-step {
      font-weight: 600;
      color: var(--primary-blue);
    }

    .progress-bar-track {
      width: 100%;
      height: 6px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--primary-blue), var(--accent-blue));
      border-radius: 999px;
      transition: width 0.3s ease;
    }

    .progress-steps {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 11px;
      color: var(--muted);
    }

    .progress-steps span.active-step {
      color: var(--primary-blue);
      font-weight: 600;
    }

    /* Form */

    form {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .step {
      display: none;
    }

    .step.active {
      display: block;
    }

    .step-title {
      font-weight: 600;
      margin-bottom: 6px;
    }

    .step-subtitle {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 16px;
    }

    .grid {
      display: grid;
      gap: 16px;
    }

    @media (min-width: 640px) {
      .grid-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    label.field-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .field-label span.badge {
      font-weight: 400;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      border-radius: 999px;
      padding: 1px 8px;
      border: 1px solid #e5e7eb;
      margin-left: 6px;
      color: var(--muted);
    }

    .help-text {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    select,
    textarea {
      width: 100%;
      border-radius: 8px;
      border: 1px solid var(--border-grey);
      padding: 10px 11px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
      background: var(--white);
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 1px rgba(31, 78, 121, 0.2);
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    .checkbox-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      border: 1px solid var(--border-grey);
      padding: 4px 10px;
      font-size: 12px;
      cursor: pointer;
      color: var(--muted);
      background: #f9fafb;
    }

    .chip input {
      margin: 0;
    }

    .footer-row {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 8px;
    }

    @media (min-width: 640px) {
      .footer-row {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }
    }

    .buttons {
      display: flex;
      gap: 10px;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 9px 18px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    button.primary {
      background: var(--primary-blue);
      color: var(--white);
    }

    button.primary[disabled] {
      opacity: 0.7;
      cursor: default;
    }

    button.secondary {
      background: #e5e7eb;
      color: #111827;
    }

    .status-message {
      font-size: 13px;
      min-height: 18px;
    }

    .status-message.error {
      color: var(--error);
    }

    .status-message.success {
      color: var(--success);
    }

    .small-print {
      font-size: 11px;
      color: var(--muted);
      line-height: 1.4;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="brand">
        <div class="logo-circle">TB</div>
        <div class="brand-text">
          <span>TradeBotPro</span>
          <span>AI office for trades & home services</span>
        </div>
      </div>
    </header>

    <main>
      <div class="shell">
        <div class="shell-header">
          <h1>Tell us about your business</h1>
          <p>Answer a few quick questions and we’ll set up your AI office assistant for you.</p>
        </div>

        <!-- Progress bar -->
        <div class="progress">
          <div class="progress-label-row">
            <span class="current-step" id="current-step-label">Step 1 of 3</span>
            <span id="progress-summary-label">Business basics</span>
          </div>
          <div class="progress-bar-track">
            <div class="progress-bar-fill" id="progress-bar-fill"></div>
          </div>
          <div class="progress-steps">
            <span id="step-label-1" class="active-step">1 · Business</span>
            <span id="step-label-2">2 · Service area</span>
            <span id="step-label-3">3 · AI office focus</span>
          </div>
        </div>

        <form id="signup-form" novalidate>
          <!-- STEP 1: BUSINESS BASICS -->
          <div class="step active" data-step="1">
            <div class="step-title">Business basics</div>
            <div class="step-subtitle">
              This helps us personalise your AI office so it sounds like <strong>your</strong> business.
            </div>

            <div class="grid grid-2">
              <div>
                <label class="field-label" for="business_name">
                  Business name
                  <span class="badge">Required</span>
                </label>
                <input type="text" id="business_name" name="business_name" autocomplete="organization" required />
                <div class="help-text">e.g. “TEST PLUMBER LTD”</div>
              </div>

              <div>
                <label class="field-label" for="contact_name">
                  Your name
                  <span class="badge">Required</span>
                </label>
                <input type="text" id="contact_name" name="contact_name" autocomplete="name" required />
                <div class="help-text">The main person we’ll work with to set things up.</div>
              </div>

              <div>
                <label class="field-label" for="email">
                  Work email
                  <span class="badge">Required</span>
                </label>
                <input type="email" id="email" name="email" autocomplete="email" required />
                <div class="help-text">We’ll send your setup link and updates here.</div>
              </div>

              <div>
                <label class="field-label" for="phone">
                  Mobile or WhatsApp number
                  <span class="badge">Required</span>
                </label>
                <input type="tel" id="phone" name="phone" autocomplete="tel" required />
                <div class="help-text">Include country code if you’re outside the UK.</div>
              </div>

              <div>
                <label class="field-label" for="trade_type">
                  Trade / main service
                  <span class="badge">Required</span>
                </label>
                <select id="trade_type" name="trade_type" required>
                  <option value="">Select one</option>
                  <option value="Plumbing & heating">Plumbing &amp; heating</option>
                  <option value="Gas & boilers">Gas &amp; boilers</option>
                  <option value="Electrical">Electrical</option>
                  <option value="Roofing">Roofing</option>
                  <option value="Landscaping & gardens">Landscaping &amp; gardens</option>
                  <option value="Bathrooms & kitchens">Bathrooms &amp; kitchens</option>
                  <option value="General building">General building</option>
                  <option value="Other">Other</option>
                </select>
                <div class="help-text">This is how we’ll describe you in messages to customers.</div>
              </div>
            </div>
          </div>

          <!-- STEP 2: SERVICE AREA -->
          <div class="step" data-step="2">
            <div class="step-title">Where do you work?</div>
            <div class="step-subtitle">
              We’ll use this to keep enquiries inside your area and stop time-wasting leads.
            </div>

            <div class="grid grid-2">
              <div>
                <label class="field-label" for="base_postcode">
                  Base postcode
                  <span class="badge">Required</span>
                </label>
                <input type="text" id="base_postcode" name="base_postcode" autocomplete="postal-code" required />
                <div class="help-text">e.g. HP14 3QF or SE1 1AA</div>
              </div>

              <div>
                <label class="field-label" for="service_radius">
                  Approximate radius you cover
                </label>
                <input type="text" id="service_radius" name="service_radius" />
                <div class="help-text">
                  e.g. “10 miles”, “All of West London”, “Within the M25”.
                </div>
              </div>

              <div>
                <label class="field-label" for="website_url">
                  Website (if you have one)
                </label>
                <input type="text" id="website_url" name="website_url" placeholder="https://…" />
                <div class="help-text">We’ll scan this so your AI office talks like your existing site.</div>
              </div>

              <div>
                <label class="field-label" for="services_summary">
                  Services you offer
                </label>
                <textarea
                  id="services_summary"
                  name="services_summary"
                  placeholder="Example: Boiler installs, boiler servicing, emergency leaks, bathroom plumbing, landlord gas safety certificates..."
                ></textarea>
                <div class="help-text">
                  Bullet points are fine — we’ll tidy this up for you.
                </div>
              </div>
            </div>
          </div>

          <!-- STEP 3: AI OFFICE FOCUS -->
          <div class="step" data-step="3">
            <div class="step-title">What should your AI office focus on first?</div>
            <div class="step-subtitle">
              This is the most important bit. Pretend you’ve hired an office manager — what do you want them to handle on day one?
            </div>

            <div>
              <label class="field-label">
                Pick 2–3 priorities to start with
              </label>
              <div class="checkbox-row">
                <label class="chip">
                  <input type="checkbox" name="ai_focus_tags" value="Handle new enquiries 24/7" />
                  <span>Handle new enquiries 24/7</span>
                </label>
                <label class="chip">
                  <input type="checkbox" name="ai_focus_tags" value="Quote and estimate prep" />
                  <span>Quote &amp; estimate prep</span>
                </label>
                <label class="chip">
                  <input type="checkbox" name="ai_focus_tags" value="Booking jobs into my diary" />
                  <span>Booking jobs into my diary</span>
                </label>
                <label class="chip">
                  <input type="checkbox" name="ai_focus_tags" value="Chasing late payments" />
                  <span>Chasing late payments</span>
                </label>
                <label class="chip">
                  <input type="checkbox" name="ai_focus_tags" value="Follow-up & reviews" />
                  <span>Follow-up &amp; reviews</span>
                </label>
                <label class="chip">
                  <input type="checkbox" name="ai_focus_tags" value="Something else" />
                  <span>Something else</span>
                </label>
              </div>
              <div class="help-text">
                These help us configure your AI office in the right order instead of trying to do everything at once.
              </div>
            </div>

            <div style="margin-top: 14px;">
              <label class="field-label" for="ai_focus_detail">
                In your own words, what should we get right first?
                <span class="badge">Helpful</span>
              </label>
              <textarea
                id="ai_focus_detail"
                name="ai_focus_detail"
                placeholder="Example: “I want it to answer boiler breakdown enquiries at night, book jobs into my Google Calendar, and collect all the info I need so I can price the job quickly in the morning...”"
              ></textarea>
              <div class="help-text">
                Don’t worry about perfect wording — just talk to us like you would on WhatsApp.
              </div>
            </div>

            <div style="margin-top: 16px;">
              <label class="field-label" for="notes">
                Anything else we should know?
              </label>
              <textarea
                id="notes"
                name="notes"
                placeholder="Access notes, special pricing, how you currently run bookings, tools you already use (Jobber, ServiceM8, Tradify, Google Calendar, etc.)"
              ></textarea>
            </div>

            <div style="margin-top: 16px;">
              <label class="chip">
                <input type="checkbox" name="consent" id="consent" required />
                <span style="font-size: 12px;">
                  I’m happy for TradeBotPro to contact me about setting up my AI office and to store my details for this purpose.
                </span>
              </label>
              <div class="small-print" style="margin-top: 6px;">
                We’ll never sell your data. You can ask us to delete everything at any time.
              </div>
            </div>
          </div>

          <!-- FOOTER: NAV + STATUS -->
          <div class="footer-row">
            <div class="buttons">
              <button type="button" class="secondary" id="back-btn">Back</button>
              <button type="button" class="primary" id="next-btn">
                Next
              </button>
              <button type="submit" class="primary hidden" id="submit-btn">
                Submit your details
              </button>
            </div>
            <div class="status-message" id="status-message"></div>
          </div>

          <div class="small-print" style="margin-top: 8px;">
            By submitting, you’re not committing to a subscription. We’ll review your answers, set up a draft AI assistant and
            then agree next steps with you.
          </div>
        </form>
      </div>
    </main>
  </div>

  <!-- Supabase client -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.48.0/dist/umd/supabase.js"></script>

  <script>
    // ----------------------------
    // 1. PROGRESS / STEP HANDLING
    // ----------------------------

    const steps = Array.from(document.querySelectorAll(".step"));
    const backBtn = document.getElementById("back-btn");
    const nextBtn = document.getElementById("next-btn");
    const submitBtn = document.getElementById("submit-btn");
    const progressFill = document.getElementById("progress-bar-fill");
    const currentStepLabel = document.getElementById("current-step-label");
    const progressSummaryLabel = document.getElementById("progress-summary-label");
    const statusMessageEl = document.getElementById("status-message");

    const stepLabelsMap = {
      1: { summary: "Business basics" },
      2: { summary: "Service area & services" },
      3: { summary: "AI office focus" },
    };

    let currentStep = 1;
    const totalSteps = steps.length;

    function updateStepUI() {
      steps.forEach((step) => {
        step.classList.toggle("active", Number(step.dataset.step) === currentStep);
      });

      const percent = (currentStep / totalSteps) * 100;
      progressFill.style.width = percent + "%";

      currentStepLabel.textContent = `Step ${currentStep} of ${totalSteps}`;
      progressSummaryLabel.textContent = stepLabelsMap[currentStep].summary;

      // Update mini labels
      for (let i = 1; i <= totalSteps; i++) {
        const label = document.getElementById(`step-label-${i}`);
        if (label) {
          label.classList.toggle("active-step", i === currentStep);
        }
      }

      // Buttons
      backBtn.disabled = currentStep === 1;
      if (currentStep === totalSteps) {
        nextBtn.classList.add("hidden");
        submitBtn.classList.remove("hidden");
      } else {
        nextBtn.classList.remove("hidden");
        submitBtn.classList.add("hidden");
      }

      // Clear status text when moving steps
      setStatusMessage("");
    }

    backBtn.addEventListener("click", () => {
      if (currentStep > 1) {
        currentStep--;
        updateStepUI();
      }
    });

    nextBtn.addEventListener("click", () => {
      if (currentStep < totalSteps) {
        currentStep++;
        updateStepUI();
      }
    });

    updateStepUI();

    // ----------------------------
    // 2. SUPABASE CONFIG
    // ----------------------------

    // TODO: REPLACE with your real values again after pasting:
    const SUPABASE_URL = "https://yaiutswdcbfwkxfqxkzy.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhaXV0c3dkY2Jmd2t4ZnF4a3p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDE2MDgsImV4cCI6MjA4MDA3NzYwOH0.HOLFxzjsZ5Ieqg0b-aTdP0hAdLsPVXL6Zjs-HgOHgc8";


    if (!window.supabase) {
      console.error("Supabase JS not loaded – check the <script> src URL.");
    }

    const supabaseClient =
      window.supabase && SUPABASE_URL && SUPABASE_ANON_KEY
        ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
        : null;

    if (!supabaseClient) {
      console.error("Supabase client not initialised. Check SUPABASE_URL and SUPABASE_ANON_KEY in the page.");
    }

    // ----------------------------
    // 3. FORM SUBMIT HANDLER
    // ----------------------------

    const form = document.getElementById("signup-form");

    function setLoading(isLoading) {
      if (isLoading) {
        submitBtn.disabled = true;
        submitBtn.textContent = "Saving your details...";
      } else {
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit your details";
      }
    }

    function setStatusMessage(message, type = "") {
      statusMessageEl.textContent = message;
      statusMessageEl.classList.remove("error", "success");
      if (type) statusMessageEl.classList.add(type);
    }

    form.addEventListener("submit", async (event) => {
      event.preventDefault();

      if (!supabaseClient) {
        setStatusMessage(
          "Something went wrong saving your details. Please try again or contact us.",
          "error"
        );
        console.error("Supabase client is not ready – aborting submit.");
        return;
      }

      const formData = new FormData(form);

      // Collect tags from the chips
      const focusTags = formData.getAll("ai_focus_tags");
      const aiFocusDetail = (formData.get("ai_focus_detail") || "").toString().trim();

      // This gets stored into ai_style_notes to keep schema simple
      const combinedAiNotes = [
        focusTags.length ? "Priorities: " + focusTags.join(", ") : "",
        aiFocusDetail ? "Detail: " + aiFocusDetail : "",
      ]
        .filter(Boolean)
        .join("\n\n");

      const payload = {
        business_name: (formData.get("business_name") || "").toString().trim() || null,
        contact_name: (formData.get("contact_name") || "").toString().trim() || null,
        email: (formData.get("email") || "").toString().trim() || null,
        phone: (formData.get("phone") || "").toString().trim() || null,
        whatsapp_number: (formData.get("phone") || "").toString().trim() || null, // reuse
        trade_type: formData.get("trade_type") || null,
        base_postcode: (formData.get("base_postcode") || "").toString().trim() || null,
        service_radius: (formData.get("service_radius") || "").toString().trim() || null,
        website_url: (formData.get("website_url") || "").toString().trim() || null,
        services_summary: (formData.get("services_summary") || "").toString().trim() || null,
        ai_style_notes: combinedAiNotes || null,
        notes: (formData.get("notes") || "").toString().trim() || null,
        plan_status: "Trial requested",
        pending_setup: true,
        is_active: true,
      };

      // Basic required field check in the browser
      if (!payload.business_name || !payload.contact_name || !payload.email || !payload.phone || !payload.trade_type || !payload.base_postcode) {
        setStatusMessage("Please fill in all required fields (business name, your name, email, phone, trade, postcode).", "error");
        return;
      }

      if (!formData.get("consent")) {
        setStatusMessage("Please tick the consent box so we know we’re allowed to contact you.", "error");
        return;
      }

      try {
        setLoading(true);
        setStatusMessage("");

        // Insert ONLY into tradebotpro_signups – trigger will copy into business_profiles
        const { data, error } = await supabaseClient
          .from("tradebotpro_signups")
          .insert([payload])
          .select()
          .single();

        if (error) {
          console.error("Supabase insert error (tradebotpro_signups):", error);
          setStatusMessage(
            "Something went wrong saving your details. Please try again or contact us.",
            "error"
          );
          return;
        }

        console.log("Signup saved:", data);
        setStatusMessage(
          "Thank you — your details are saved. We’ll be in touch about setting up your AI office.",
          "success"
        );

        // Optional: move the user back to step 1 or leave them on step 3
        // form.reset();
      } catch (err) {
        console.error("Unexpected error while saving signup:", err);
        setStatusMessage(
          "Something went wrong saving your details. Please try again or contact us.",
          "error"
        );
      } finally {
        setLoading(false);
      }
    });
  </script>
</body>
</html>
