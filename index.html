<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>TradeBotPro – Signup</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  body {
    margin: 0;
    padding: 32px 16px;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: #f5f7fa;
    color: #1b1b1f;
  }

  h1, h2 {
    margin-top: 0;
    color: #1f4e79;
  }

  .card {
    max-width: 820px;
    margin: auto;
    background: #fff;
    padding: 28px;
    border-radius: 18px;
    box-shadow: 0 18px 50px rgba(0,0,0,.12);
  }

  .progress {
    margin-bottom: 20px;
  }

  .progress-top {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    margin-bottom: 6px;
  }

  .progress-bar {
    height: 6px;
    background: #e5e7eb;
    border-radius: 999px;
    overflow: hidden;
  }

  .progress-bar-inner {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg,#1f4e79,#00a3ff);
    transition: width .3s;
  }

  .step {
    display: none;
  }

  .step.active {
    display: block;
  }

  label {
    display: block;
    font-weight: 600;
    margin-bottom: 4px;
  }

  .field {
    margin-bottom: 16px;
  }

  input, textarea, select {
    width: 100%;
    padding: 9px 10px;
    border-radius: 8px;
    border: 1px solid #d1d5db;
    font-size: 15px;
  }

  textarea { min-height: 70px; }

  .row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .chips {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .chip {
    padding: 6px 12px;
    border-radius: 999px;
    border: 1px solid #1f4e79;
    background: #edf2ff;
    cursor: pointer;
    font-size: 14px;
  }

  .chip.selected {
    background: #1f4e79;
    color: #fff;
  }

  .footer {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
  }

  button {
    padding: 9px 18px;
    border-radius: 999px;
    border: none;
    cursor: pointer;
    font-size: 15px;
  }

  .next {
    background: #1f4e79;
    color: #fff;
  }

  .back {
    background: #e5e7eb;
  }

  .status {
    display: none;
    margin-top: 16px;
    padding: 10px;
    border-radius: 8px;
  }

  .success {
    background: #ecfdf3;
    color: #166534;
  }

  .error {
    background: #fef2f2;
    color: #991b1b;
  }
</style>
</head>
<body>

<div class="card">
  <h1>TradeBotPro Signup</h1>

  <div class="progress">
    <div class="progress-top">
      <span>Step <strong id="stepNo">1</strong> of 4</span>
      <span id="stepLabel">Business basics</span>
    </div>
    <div class="progress-bar">
      <div class="progress-bar-inner" id="progressBar"></div>
    </div>
  </div>

  <form id="form">

    <!-- STEP 1 -->
    <div class="step active" data-step="1">
      <div class="field">
        <label>Business name</label>
        <input id="business_name" required />
      </div>

      <div class="row">
        <div class="field">
          <label>Your name</label>
          <input id="owner_name" required />
        </div>
        <div class="field">
          <label>Email</label>
          <input type="email" id="email" required />
        </div>
      </div>

      <div class="footer">
        <span></span>
        <button type="button" class="next">Next</button>
      </div>
    </div>

    <!-- STEP 2 -->
    <div class="step" data-step="2">
      <div class="field">
        <label>Trade</label>
        <select id="trade_type">
          <option>Plumbing</option>
          <option>Plumbing & Heating</option>
          <option>Electrician</option>
        </select>
      </div>

      <div class="row">
        <div class="field">
          <label>Phone</label>
          <input id="phone" />
        </div>
        <div class="field">
          <label>Base postcode</label>
          <input id="base_postcode" />
        </div>
      </div>

      <div class="footer">
        <button type="button" class="back">Back</button>
        <button type="button" class="next">Next</button>
      </div>
    </div>

    <!-- STEP 3 -->
    <div class="step" data-step="3">
      <label>What should your AI focus on?</label>
      <div class="chips" id="chips">
        <div class="chip">Answering enquiries</div>
        <div class="chip">Booking jobs</div>
        <div class="chip">Following up quotes</div>
        <div class="chip">Out of hours cover</div>
      </div>

      <div class="field">
        <label>Anything specific? (optional)</label>
        <textarea id="ai_extra"></textarea>
      </div>

      <div class="footer">
        <button type="button" class="back">Back</button>
        <button type="button" class="next">Next</button>
      </div>
    </div>

    <!-- STEP 4 -->
    <div class="step" data-step="4">
      <p>Click submit and we’ll take it from here.</p>

      <div class="footer">
        <button type="button" class="back">Back</button>
        <button type="submit" class="next">Submit</button>
      </div>

      <div class="status success" id="success">✅ Submitted successfully</div>
      <div class="status error" id="error">⚠️ Something went wrong</div>
    </div>

  </form>
</div>

<script>
/* CONFIG */
const SUPABASE_URL = "https://yaiutswdcbfwkxfqxkzy.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhaXV0c3dkY2Jmd2t4ZnF4a3p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDE2MDgsImV4cCI6MjA4MDA3NzYwOH0.HOLFxzjsZ5Ieqg0b-aTdP0hAdLsPVXL6Zjs-HgOHgc8";

/* STEPS */
let step = 1;
const steps = document.querySelectorAll('.step');
const bar = document.getElementById('progressBar');
const stepNo = document.getElementById('stepNo');
const stepLabel = document.getElementById('stepLabel');

const labels = {
  1:'Business basics',
  2:'Contact info',
  3:'AI focus',
  4:'Confirm'
};

function showStep(n){
  step=n;
  steps.forEach(s=>s.classList.remove('active'));
  document.querySelector(`[data-step="${step}"]`).classList.add('active');
  bar.style.width=((step-1)/3*100)+'%';
  stepNo.textContent=step;
  stepLabel.textContent=labels[step];
}

document.addEventListener('click',e=>{
  if(e.target.classList.contains('next')) showStep(step+1);
  if(e.target.classList.contains('back')) showStep(step-1);
});

/* CHIPS */
const chipEls=document.querySelectorAll('.chip');
chipEls.forEach(c=>c.onclick=()=>c.classList.toggle('selected'));

/* SUBMIT */
document.getElementById('form').onsubmit=async e=>{
  e.preventDefault();

  const focus=[...chipEls].filter(c=>c.classList.contains('selected')).map(c=>c.textContent);

  const payload={
    business_name:business_name.value,
    owner_name:owner_name.value,
    email:email.value,
    phone:phone.value,
    trade_type:trade_type.value,
    base_postcode:base_postcode.value,
    services_summary: 'Focus: '+focus.join(', ')+' | '+ai_extra.value,
    plan_status:'Lead - New',
    pending_setup:true,
    account_status:'Lead - New'
  };

  try{
    const res=await fetch(`${SUPABASE_URL}/rest/v1/tradebotpro_signups`,{
      method:'POST',
      headers:{
        'Content-Type':'application/json',
        apikey:SUPABASE_ANON_KEY,
        Authorization:`Bearer ${SUPABASE_ANON_KEY}`
      },
      body:JSON.stringify(payload)
    });

    if(!res.ok) throw new Error();
    success.style.display='block';
  }catch{
    error.style.display='block';
  }
};
</script>

</body>
</html>
