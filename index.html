<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TradeBotPro — Signup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="Sign up to TradeBotPro — AI office assistant for trades and home services."
  />

  <style>
    :root {
      --primary-blue: #1f4e79;
      --accent-blue: #00a3ff;
      --dark-text: #1b1b1f;
      --light-bg: #f5f7fa;
      --white: #ffffff;
      --border-radius: 14px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--light-bg);
      color: var(--dark-text);
    }

    .page {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .card {
      background: var(--white);
      max-width: 900px;
      width: 100%;
      border-radius: 24px;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.08);
      padding: 24px;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
      gap: 24px;
    }

    @media (max-width: 768px) {
      .card {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .left-header h1 {
      margin: 0 0 8px;
      font-size: 1.8rem;
    }

    .left-header p {
      margin: 0;
      color: #555;
      font-size: 0.95rem;
    }

    .progress-wrapper {
      margin-top: 20px;
      margin-bottom: 20px;
    }

    .progress-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 6px;
    }

    .progress-bar {
      position: relative;
      height: 8px;
      background: #e1e6f0;
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-bar-fill {
      position: absolute;
      inset: 0;
      width: 0%;
      background: linear-gradient(90deg, var(--primary-blue), var(--accent-blue));
      transition: width 0.25s ease-out;
    }

    .steps-row {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 0.75rem;
      color: #666;
    }

    .step-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: #f0f3fb;
    }

    .step-pill.active {
      background: rgba(0, 163, 255, 0.1);
      color: var(--primary-blue);
      font-weight: 600;
    }

    .step-pill span.step-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      font-size: 0.7rem;
      background: var(--primary-blue);
      color: #fff;
    }

    form {
      margin-top: 16px;
    }

    .form-step {
      display: none;
      animation: fadeIn 0.2s ease-out;
    }

    .form-step.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .field-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .field {
      margin-bottom: 12px;
    }

    .field label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 4px;
      font-weight: 600;
    }

    .field label span.req {
      color: #c0392b;
      margin-left: 2px;
    }

    .field input,
    .field select,
    .field textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #d1d7e5;
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.15s ease-out, box-shadow 0.15s ease-out;
      font-family: inherit;
      resize: vertical;
    }

    .field input:focus,
    .field select:focus,
    .field textarea:focus {
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 1px rgba(0, 163, 255, 0.15);
    }

    .field small {
      display: block;
      color: #888;
      font-size: 0.75rem;
      margin-top: 2px;
    }

    .actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
      gap: 12px;
    }

    .actions-left {
      font-size: 0.8rem;
      color: #666;
    }

    .actions-right {
      display: flex;
      gap: 8px;
    }

    button {
      font-family: inherit;
      font-size: 0.9rem;
      border-radius: 999px;
      border: none;
      padding: 9px 18px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-secondary {
      background: #eef1f8;
      color: #333;
    }

    .btn-primary {
      background: var(--primary-blue);
      color: #fff;
    }

    .btn-primary:disabled {
      opacity: 0.7;
      cursor: wait;
    }

    .status-banner {
      margin-top: 12px;
      font-size: 0.85rem;
      padding: 8px 10px;
      border-radius: 10px;
      display: none;
    }

    .status-banner.error {
      background: #fdecea;
      color: #c0392b;
      border: 1px solid #f5c2c0;
    }

    .status-banner.success {
      background: #e9f7ef;
      color: #1e824c;
      border: 1px solid #c3e6cb;
    }

    .right-panel {
      border-radius: 18px;
      background: radial-gradient(circle at top left, #00a3ff 0, #1f4e79 55%, #040c34 100%);
      color: #f5f7fa;
      padding: 18px 18px 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .right-panel-header h2 {
      margin: 0 0 6px;
      font-size: 1.2rem;
    }

    .right-panel-header p {
      margin: 0;
      font-size: 0.85rem;
      opacity: 0.9;
    }

    .benefits {
      margin-top: 14px;
      list-style: none;
      padding: 0;
    }

    .benefits li {
      font-size: 0.85rem;
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
      align-items: flex-start;
    }

    .benefits li span.bullet {
      margin-top: 3px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.14);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }

    .bottom-note {
      margin-top: 16px;
      font-size: 0.75rem;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <!-- LEFT: FORM -->
      <div>
        <div class="left-header">
          <h1>Tell us about your business</h1>
          <p>2–3 minutes. No payment today. This just gives us enough detail to set up your AI office assistant.</p>
        </div>

        <!-- PROGRESS -->
        <div class="progress-wrapper">
          <div class="progress-labels">
            <span>Step <span id="progress-step-label">1</span> of 3</span>
            <span id="progress-percent-label">33%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-bar-fill" id="progress-bar-fill"></div>
          </div>
          <div class="steps-row">
            <div class="step-pill" data-step-pill="1">
              <span class="step-number">1</span>
              <span>Basics</span>
            </div>
            <div class="step-pill" data-step-pill="2">
              <span class="step-number">2</span>
              <span>Contact</span>
            </div>
            <div class="step-pill" data-step-pill="3">
              <span class="step-number">3</span>
              <span>Pricing & notes</span>
            </div>
          </div>
        </div>

        <!-- FORM -->
        <form id="signup-form">
          <!-- STEP 1 -->
          <div class="form-step active" data-step="1">
            <div class="field">
              <label for="business_name">Business name<span class="req">*</span></label>
              <input id="business_name" name="business_name" type="text" required />
              <small>Registered name or trading name.</small>
            </div>

            <div class="field-row">
              <div class="field">
                <label for="trade_type">Trade / main service<span class="req">*</span></label>
                <select id="trade_type" name="trade_type" required>
                  <option value="">Select…</option>
                  <option value="Plumbing & Heating">Plumbing &amp; Heating</option>
                  <option value="Gas Engineer">Gas Engineer</option>
                  <option value="Boiler Specialist">Boiler Specialist</option>
                  <option value="General Plumbing">General Plumbing</option>
                  <option value="Electrical">Electrical</option>
                  <option value="Other">Other</option>
                </select>
              </div>

              <div class="field">
                <label for="base_postcode">Base postcode<span class="req">*</span></label>
                <input id="base_postcode" name="base_postcode" type="text" placeholder="e.g. HP14 3QF" required />
                <small>Where you normally start your day from.</small>
              </div>
            </div>

            <div class="field-row">
              <div class="field">
                <label for="service_radius">Service radius (miles)</label>
                <input id="service_radius" name="service_radius" type="number" min="1" max="60" placeholder="e.g. 15" />
              </div>

              <div class="field">
                <label for="website_url">Website (optional)</label>
                <input id="website_url" name="website_url" type="url" placeholder="https://…" />
              </div>
            </div>
          </div>

          <!-- STEP 2 -->
          <div class="form-step" data-step="2">
            <div class="field-row">
              <div class="field">
                <label for="contact_name">Main contact name<span class="req">*</span></label>
                <input id="contact_name" name="contact_name" type="text" required />
                <small>Who should the AI assistant act on behalf of?</small>
              </div>

              <div class="field">
                <label for="email">Best email<span class="req">*</span></label>
                <input id="email" name="email" type="email" required />
              </div>
            </div>

            <div class="field-row">
              <div class="field">
                <label for="phone">Main phone number<span class="req">*</span></label>
                <input id="phone" name="phone" type="tel" required />
                <small>Where customers would normally call you.</small>
              </div>

              <div class="field">
                <label for="whatsapp_number">WhatsApp number (if different)</label>
                <input id="whatsapp_number" name="whatsapp_number" type="tel" />
              </div>
            </div>
          </div>

          <!-- STEP 3 -->
          <div class="form-step" data-step="3">
            <div class="field-row">
              <div class="field">
                <label for="callout_fee">Call-out fee (if any)</label>
                <input id="callout_fee" name="callout_fee" type="text" placeholder="e.g. £60 + VAT" />
              </div>

              <div class="field">
                <label for="first_hour_rate">First hour rate</label>
                <input id="first_hour_rate" name="first_hour_rate" type="text" placeholder="e.g. £90 + VAT" />
              </div>
            </div>

            <div class="field-row">
              <div class="field">
                <label for="hourly_rate">Hourly rate thereafter</label>
                <input id="hourly_rate" name="hourly_rate" type="text" placeholder="e.g. £60 + VAT" />
              </div>

              <div class="field">
                <label for="boiler_service_from">Boiler service from</label>
                <input id="boiler_service_from" name="boiler_service_from" type="text" placeholder="e.g. £90" />
              </div>
            </div>

            <div class="field-row">
              <div class="field">
                <label for="quote_minimum">Minimum quote value</label>
                <input id="quote_minimum" name="quote_minimum" type="text" placeholder="e.g. £150" />
              </div>

              <div class="field">
                <label for="plan_status">Plan status</label>
                <select id="plan_status" name="plan_status">
                  <option value="Trial">Trial</option>
                  <option value="Active Monthly">Active Monthly</option>
                  <option value="Active Annual">Active Annual</option>
                  <option value="Prospect">Prospect</option>
                </select>
              </div>
            </div>

            <div class="field">
              <label for="services_summary">What should your AI office focus on?<span class="req">*</span></label>
              <textarea
                id="services_summary"
                name="services_summary"
                rows="4"
                placeholder="e.g. Emergency leaks, boiler breakdowns, landlord gas safety, annual servicing, bathroom installs…"
                required
              ></textarea>
              <small>Bullet points are fine.</small>
            </div>
          </div>

          <!-- STATUS MESSAGES -->
          <div id="status-error" class="status-banner error"></div>
          <div id="status-success" class="status-banner success"></div>

          <!-- ACTIONS -->
          <div class="actions">
            <div class="actions-left">
              <span id="step-hint">Next: contact details</span>
            </div>
            <div class="actions-right">
              <button type="button" class="btn-secondary" id="back-btn">Back</button>
              <button type="button" class="btn-primary" id="next-btn">Next</button>
              <button type="submit" class="btn-primary" id="submit-btn" style="display: none;">
                Submit details
              </button>
            </div>
          </div>
        </form>
      </div>

      <!-- RIGHT: CONTEXT / BENEFITS -->
      <aside class="right-panel">
        <div class="right-panel-header">
          <h2>What happens next?</h2>
          <p>
            Once you submit this form, we’ll wire your details into an AI assistant that sounds like your office,
            not a robot.
          </p>
        </div>

        <ul class="benefits">
          <li>
            <span class="bullet">✓</span>
            <span>Customers can message you 24/7 on WhatsApp or your website to get instant answers &amp; quotes.</span>
          </li>
          <li>
            <span class="bullet">✓</span>
            <span>We’ll use your own pricing, travel radius, and job preferences — not generic boilerplate replies.</span>
          </li>
          <li>
            <span class="bullet">✓</span>
            <span>You’ll still approve anything important: the AI just takes care of the repetitive admin.</span>
          </li>
        </ul>

        <div class="bottom-note">
          No payment is taken from this form. We’ll contact you first to confirm everything looks right before
          switching anything on.
        </div>
      </aside>
    </div>
  </div>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // TODO: put your real Supabase values in here
    const SUPABASE_URL = "https://yaiutswdcbfwkxfqxkzy.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhaXV0c3dkY2Jmd2t4ZnF4a3p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDE2MDgsImV4cCI6MjA4MDA3NzYwOH0.HOLFxzjsZ5Ieqg0b-aTdP0hAdLsPVXL6Zjs-HgOHgc8";

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const form = document.getElementById("signup-form");
    const progressFill = document.getElementById("progress-bar-fill");
    const progressStepLabel = document.getElementById("progress-step-label");
    const progressPercentLabel = document.getElementById("progress-percent-label");
    const stepHint = document.getElementById("step-hint");
    const backBtn = document.getElementById("back-btn");
    const nextBtn = document.getElementById("next-btn");
    const submitBtn = document.getElementById("submit-btn");
    const errorBanner = document.getElementById("status-error");
    const successBanner = document.getElementById("status-success");

    const TOTAL_STEPS = 3;
    let currentStep = 1;
    let isSubmitting = false;

    function updateStepUI() {
      // Progress percentage
      const percent = Math.round((currentStep / TOTAL_STEPS) * 100);
      progressFill.style.width = percent + "%";
      progressStepLabel.textContent = String(currentStep);
      progressPercentLabel.textContent = percent + "%";

      // Pills
      document.querySelectorAll(".step-pill").forEach((pill) => {
        const step = Number(pill.getAttribute("data-step-pill"));
        pill.classList.toggle("active", step === currentStep);
      });

      // Steps visibility
      document.querySelectorAll(".form-step").forEach((stepEl) => {
        const step = Number(stepEl.getAttribute("data-step"));
        stepEl.classList.toggle("active", step === currentStep);
      });

      // Buttons & hint
      backBtn.style.visibility = currentStep === 1 ? "hidden" : "visible";
      nextBtn.style.display = currentStep < TOTAL_STEPS ? "inline-flex" : "none";
      submitBtn.style.display = currentStep === TOTAL_STEPS ? "inline-flex" : "none";

      if (currentStep === 1) {
        stepHint.textContent = "Next: contact details";
      } else if (currentStep === 2) {
        stepHint.textContent = "Next: pricing & notes";
      } else {
        stepHint.textContent = "Final step: pricing snapshot & notes";
      }

      // Clear banners on step change
      hideBanner(errorBanner);
      hideBanner(successBanner);
    }

    function showBanner(el, message) {
      el.textContent = message;
      el.style.display = "block";
    }

    function hideBanner(el) {
      el.textContent = "";
      el.style.display = "none";
    }

    function validateStep(step) {
      // Minimal check: use HTML5 `required` on visible inputs
      const stepEl = document.querySelector('.form-step[data-step="' + step + '"]');
      if (!stepEl) return true;

      const requiredFields = stepEl.querySelectorAll("[required]");
      for (const field of requiredFields) {
        if (!field.value.trim()) {
          field.focus();
          showBanner(errorBanner, "Please complete the required fields on this step.");
          return false;
        }
      }
      hideBanner(errorBanner);
      return true;
    }

    backBtn.addEventListener("click", () => {
      if (currentStep > 1) {
        currentStep -= 1;
        updateStepUI();
      }
    });

    nextBtn.addEventListener("click", () => {
      if (!validateStep(currentStep)) return;
      if (currentStep < TOTAL_STEPS) {
        currentStep += 1;
        updateStepUI();
      }
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (isSubmitting) return;

      if (!validateStep(currentStep)) return;

      // Gather data
      const payload = {
        business_name: document.getElementById("business_name").value.trim(),
        trade_type: document.getElementById("trade_type").value.trim() || null,
        base_postcode: document.getElementById("base_postcode").value.trim(),
        service_radius: document.getElementById("service_radius").value.trim() || null,
        website_url: document.getElementById("website_url").value.trim() || null,
        contact_name: document.getElementById("contact_name").value.trim(),
        email: document.getElementById("email").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        whatsapp_number: document.getElementById("whatsapp_number").value.trim() || null,
        callout_fee: document.getElementById("callout_fee").value.trim() || null,
        first_hour_rate: document.getElementById("first_hour_rate").value.trim() || null,
        hourly_rate: document.getElementById("hourly_rate").value.trim() || null,
        boiler_service_from: document.getElementById("boiler_service_from").value.trim() || null,
        quote_minimum: document.getElementById("quote_minimum").value.trim() || null,
        services_summary: document.getElementById("services_summary").value.trim(),
        plan_status: document.getElementById("plan_status").value || "Trial",

        // sensible defaults so your trigger can work cleanly
        is_active: true,
        pending_setup: true,
        account_status: "Active",
        account_status_reason: null,
        notes: null,
        ai_style_notes: null,
        pricing_notes: null,
        hourly_rate_from: null,
        callout_from: null,
        callout_notes: null,
      };

      // Basic sanity check
      if (!payload.business_name || !payload.email || !payload.base_postcode) {
        showBanner(errorBanner, "Business name, email, and base postcode are required.");
        return;
      }

      isSubmitting = true;
      submitBtn.disabled = true;
      submitBtn.textContent = "Submitting…";
      hideBanner(errorBanner);
      hideBanner(successBanner);

      try {
        const { error } = await supabase.from("tradebotpro_signups").insert([payload]);

        if (error) {
          console.error("Supabase insert error", error);
          showBanner(
            errorBanner,
            "We couldn't save your details just now. Please try again in a moment or contact us directly."
          );
        } else {
          showBanner(
            successBanner,
            "Thanks — your details are in. We’ll be in touch shortly to set up your AI assistant."
          );
          form.reset();
          currentStep = 1;
          updateStepUI();
        }
      } catch (err) {
        console.error("Unexpected error submitting form", err);
        showBanner(
          errorBanner,
          "Something went wrong sending your details. Please check your connection and try again."
        );
      } finally {
        isSubmitting = false;
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit details";
      }
    });

    // init
    updateStepUI();
  </script>
</body>
</html>
