<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TradeBotPro — Client Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --primary-blue:#1f4e79;
      --accent-blue:#00a3ff;
      --dark-text:#151820;
      --muted-text:#6b7280;
      --light-bg:#f3f4f9;
      --white:#ffffff;
      --border-subtle:rgba(15,23,42,0.12);
      --success-green:#0f7b46;
      --error-red:#b3261e;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      background:radial-gradient(circle at top left,#e0ebff 0,#f3f4f9 40%,#fdfdfd 100%);
      color:var(--dark-text);
      line-height:1.5;
    }

    /* Optional simple top nav */
    .tbp-nav{
      display:flex;
      gap:14px;
      padding:10px 16px;
      font-size:14px;
      max-width:1100px;
      margin:0 auto;
    }
    .tbp-nav a{
      text-decoration:none;
      font-weight:700;
      color:var(--dark-text);
      opacity:.9;
    }
    .tbp-nav a:hover{ opacity:1; text-decoration:underline; }

    header{
      border-bottom:1px solid rgba(15,23,42,0.06);
      background:rgba(248,250,252,0.96);
      backdrop-filter:blur(6px);
      position:sticky; top:0; z-index:20;
    }
    .header-inner{
      max-width:1100px;
      margin:0 auto;
      padding:0.7rem 1.25rem;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
      flex-wrap:wrap;
    }
    .brand{display:flex; align-items:center; gap:.6rem;}
    .logo-icon{width:30px;height:30px;border-radius:9px;background:var(--primary-blue);position:relative;}
    .logo-icon:before,.logo-icon:after{content:"";position:absolute;background:var(--white);border-radius:4px;}
    .logo-icon:before{width:11px;height:17px;left:7px;top:6px}
    .logo-icon:after{width:6px;height:11px;right:7px;top:9px}
    .brand-title{font-weight:800;color:var(--primary-blue);line-height:1.1}
    .brand-sub{font-size:.78rem;color:var(--muted-text)}
    .header-actions{display:flex; gap:.6rem; flex-wrap:wrap}
    .btn{
      border-radius:999px;
      border:1px solid transparent;
      padding:.55rem 1rem;
      font-size:.88rem;
      font-weight:700;
      cursor:pointer;
      background:transparent;
      display:inline-flex;
      align-items:center;
      gap:.35rem;
    }
    .btn-primary{
      background:linear-gradient(135deg,var(--primary-blue),#163857);
      color:var(--white);
      box-shadow:0 12px 28px rgba(15,23,42,0.25);
    }
    .btn-secondary{
      border-color:var(--border-subtle);
      background:#f9fafb;
      color:var(--dark-text);
    }
    .btn:disabled{opacity:.6; cursor:default; box-shadow:none}

    main{
      max-width:1100px;
      margin:0 auto;
      padding:1.2rem 1.25rem 2.5rem;
    }
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:1rem;
      align-items:start;
    }
    @media (max-width: 900px){ .grid{grid-template-columns:1fr} }

    .card{
      background:rgba(255,255,255,.92);
      border:1px solid rgba(15,23,42,0.06);
      border-radius:18px;
      box-shadow:0 24px 60px rgba(15,23,42,0.10);
      padding:1rem 1.05rem;
    }
    .card h2{
      margin:0 0 .4rem;
      font-size:1.05rem;
      color:var(--primary-blue);
    }
    .muted{color:var(--muted-text)}
    .row{display:flex; gap:.7rem; flex-wrap:wrap; align-items:center; justify-content:space-between;}

    .kvs{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:.6rem;
      margin-top:.6rem;
    }
    @media (max-width: 600px){ .kvs{grid-template-columns:1fr} }
    .kv{
      border:1px solid rgba(15,23,42,0.08);
      background:#f8fafc;
      border-radius:14px;
      padding:.65rem .75rem;
    }
    .kv .k{font-size:.72rem; text-transform:uppercase; letter-spacing:.12em; color:var(--muted-text)}
    .kv .v{font-weight:800; margin-top:.15rem}

    .pill{
      display:inline-flex;
      align-items:center;
      padding:.32rem .65rem;
      border-radius:999px;
      border:1px solid rgba(15,23,42,0.12);
      font-size:.82rem;
      font-weight:900;
      background:#fff;
    }
    .pill.success{border-color:rgba(15,123,70,.35); background:#ecfdf5; color:#0f7b46}
    .pill.warn{border-color:rgba(245,158,11,.35); background:#fffbeb; color:#92400e}
    .pill.neutral{border-color:rgba(148,163,184,.5); background:#f1f5f9; color:#334155}

    .chip-row{display:flex; flex-wrap:wrap; gap:8px; margin-top:.6rem;}
    .chip{
      border-radius:999px;
      border:1px solid rgba(0,0,0,0.12);
      background:#fff;
      padding:.4rem .85rem;
      font-size:.86rem;
      cursor:pointer;
      user-select:none;
      font-weight:800;
    }
    .chip.is-selected{
      outline:2px solid rgba(31,78,121,0.45);
      background:rgba(31,78,121,0.08);
      border-color:#1f4e79;
      color:#1f4e79;
    }

    .status{margin-top:.8rem; min-height:1.2em; font-size:.9rem; font-weight:700;}
    .status.ok{color:var(--success-green)}
    .status.err{color:var(--error-red)}
  </style>
</head>

<body>
  <nav class="tbp-nav">
    <a href="./index.html">Home</a>
    <a href="./signup.html">Sign up</a>
    <a href="./login.html">Admin login</a>
  </nav>

  <header>
    <div class="header-inner">
      <div class="brand">
        <div class="logo-icon" aria-hidden="true"></div>
        <div>
          <div class="brand-title">TradeBotPro</div>
          <div class="brand-sub">Client Dashboard</div>
        </div>
      </div>
      </div>
    </div>
  </header>

  <main>
    <div class="grid">
      <section class="card">
        <div class="row">
          <div>
            <h2 id="h-business">Loading…</h2>
            <div class="muted" id="h-contact"></div>
          </div>
          <div id="pill-wizard" class="pill neutral">Wizard: Unknown</div>
        </div>

        <div class="kvs">
          <div class="kv"><div class="k">Base Postcode</div><div class="v" id="v-postcode">—</div></div>
          <div class="kv"><div class="k">Trade</div><div class="v" id="v-trade">—</div></div>
          <div class="kv"><div class="k">Coverage</div><div class="v" id="v-coverage">—</div></div>
          <div class="kv"><div class="k">Call-out Style</div><div class="v" id="v-callout">—</div></div>
        </div>

        <div class="kvs" style="margin-top:.8rem">
          <div class="kv"><div class="k">Tone</div><div class="v" id="v-tone">—</div></div>
          <div class="kv"><div class="k">Channels</div><div class="v" id="v-channels">—</div></div>
          <div class="kv"><div class="k">Reviews</div><div class="v" id="v-reviews">—</div></div>
          <div class="kv"><div class="k">Demo slot</div><div class="v" id="v-demo-slot">—</div></div>
        </div>

        <div class="kvs" style="margin-top:.8rem">
          <div class="kv"><div class="k">Signup status</div><div class="v" id="v-signup-status">—</div></div>
          <div class="kv"><div class="k">Demo</div><div class="v" id="v-demo-status">—</div></div>
          <div class="kv"><div class="k">Free trial</div><div class="v" id="v-trial-status">—</div></div>
          <div class="kv"><div class="k">Plan</div><div class="v" id="v-plan-status">—</div></div>
        </div>

        <div class="status" id="status-msg"></div>
      </section>

      <aside class="card">
        <h2>Onboarding status</h2>
        <div class="muted">This saves to your customer record.</div>

        <div class="chip-row" data-col="signup_status" data-select="single">
          <button type="button" class="chip">New</button>
          <button type="button" class="chip">Wizard complete</button>
          <button type="button" class="chip">Demo</button>
          <button type="button" class="chip">Free Trial</button>
          <button type="button" class="chip">Live</button>
        </div>

        <div style="height:.8rem"></div>

        <h2>Demo status</h2>
        <div class="muted">Quick internal tracking.</div>

        <div class="chip-row" data-col="demo_status" data-select="single">
          <button type="button" class="chip">Not booked</button>
          <button type="button" class="chip">Booked</button>
          <button type="button" class="chip">Completed</button>
        </div>

        <div style="height:.8rem"></div>

        <h2>Trial status</h2>
        <div class="muted">Optional trial after demo.</div>

        <div class="chip-row" data-col="trial_status" data-select="single">
          <button type="button" class="chip">Not started</button>
          <button type="button" class="chip">Active</button>
          <button type="button" class="chip">Ended</button>
        </div>

        <div style="height:.8rem"></div>

        <h2>Subscription</h2>
        <div class="muted">Pick your plan (can change later).</div>

        <div class="chip-row" data-col="plan_status" data-select="single">
          <button type="button" class="chip">No plan chosen</button>
          <button type="button" class="chip">Starter</button>
          <button type="button" class="chip">Pro</button>
          <button type="button" class="chip">Elite</button>
        </div>

        <div class="chip-row" data-col="plan_term" data-select="single" style="margin-top:.5rem">
          <button type="button" class="chip">Monthly</button>
          <button type="button" class="chip">Yearly</button>
        </div>

        <div style="height:.9rem"></div>

        <h2>Quick actions</h2>
        <div class="muted">Takes you to the right pages.</div>

        <div class="chip-row" style="margin-top:.6rem">
          <button type="button" class="btn btn-secondary" id="btn-open-secure">Open secure dashboard</button>
        </div>
      </aside>
    </div>
  </main>

<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

  const SUPABASE_URL = "https://yaiutswdcbfwkxfqxkzy.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhaXV0c3dkY2Jmd2t4ZnF4a3p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDE2MDgsImV4cCI6MjA4MDA3NzYwOH0.HOLFxzjsZ5Ieqg0b-aTdP0hAdLsPVXL6Zjs-HgOHgc8";
  const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const qs = new URLSearchParams(location.search);
  const customer_id = qs.get("customer_id") || "";
  const setup_token = qs.get("setup_token") || "";

  const el = (id) => document.getElementById(id);

  const hBusiness = el("h-business");
  const hContact  = el("h-contact");
  const pillWizard = el("pill-wizard");
  const statusMsg = el("status-msg");

  const vPostcode  = el("v-postcode");
  const vTrade     = el("v-trade");
  const vCoverage  = el("v-coverage");
  const vCallout   = el("v-callout");
  const vTone      = el("v-tone");
  const vChannels  = el("v-channels");
  const vReviews   = el("v-reviews");
  const vDemoSlot  = el("v-demo-slot");

  const vSignupStatus = el("v-signup-status");
  const vDemoStatus   = el("v-demo-status");
  const vTrialStatus  = el("v-trial-status");
  const vPlanStatus   = el("v-plan-status");

  const btnOpenSecure = el("btn-open-secure");

  function setStatus(t, kind=""){
    if (!statusMsg) return;
    statusMsg.textContent = t || "";
    statusMsg.className = "status" + (kind ? " " + kind : "");
  }

  function setPill(text, type){
    if (!pillWizard) return;
    pillWizard.textContent = text;
    pillWizard.classList.remove("success","warn","neutral");
    pillWizard.classList.add(type);
  }

  function applyChip(col, value){
    if (!value) return;
    const row = document.querySelector(`.chip-row[data-col="${CSS.escape(col)}"]`);
    if (!row) return;
    row.querySelectorAll(".chip").forEach(chip => {
      chip.classList.toggle("is-selected", chip.textContent.trim() === value);
    });
  }

  function lockAllChips(){
    document.querySelectorAll(".chip-row").forEach(row => {
      row.classList.add("is-locked");
      row.querySelectorAll(".chip").forEach(chip => {
        chip.style.pointerEvents = "none";
        chip.title = "Managed by TradeBotPro";
        chip.style.opacity = chip.classList.contains("is-selected") ? "1" : "0.55";
      });
    });
  }

  async function load(){
    try{
      if (!customer_id || !setup_token) throw new Error("Missing customer_id or setup_token in URL.");

      setStatus("Loading…");

      const { data: c, error } = await sb
        .from("customers")
        .select("*")
        .eq("id", customer_id)
        .eq("setup_token", setup_token)
        .single();

      if (error) throw error;

      if (hBusiness) hBusiness.textContent = c.business_name || "Your business";
      if (hContact) hContact.textContent = [c.contact_name, c.email].filter(Boolean).join(" • ");

      const done = !!c.wizard_completed || !!c.setup_complete;
      setPill(done ? "Wizard: Complete" : "Wizard: In progress", done ? "success" : "warn");

      if (vPostcode) vPostcode.textContent = c.base_postcode || "—";
      if (vTrade) vTrade.textContent = c.trade_type || "—";

      const w = c.wizard_answers || {};
      if (vCoverage) vCoverage.textContent = (w.coverage || w.service_areas || w.service_radius || "—").toString();
      if (vCallout) vCallout.textContent = (w.callout || w.callout_fee || w.callout_notes || "—").toString();
      if (vTone) vTone.textContent = (w.tone || w.ai_style || w.ai_style_notes || "—").toString();
      if (vChannels) vChannels.textContent = (w.channels || w.channel_list || "—").toString();
      if (vReviews) vReviews.textContent = (w.reviews || w.review_link || "—").toString();
      if (vDemoSlot) vDemoSlot.textContent = (w.demo_slot || w.demo_time || "—").toString();

      if (vSignupStatus) vSignupStatus.textContent = c.signup_status || c.onboarding_status || "—";
      if (vDemoStatus) vDemoStatus.textContent = c.demo_status || "—";
      if (vTrialStatus) vTrialStatus.textContent = c.trial_status || "—";
      if (vPlanStatus) vPlanStatus.textContent = c.plan_status || c.plan_name || "—";

      applyChip("signup_status", c.signup_status || "");
      applyChip("demo_status", c.demo_status || "");
      applyChip("trial_status", c.trial_status || "");
      applyChip("plan_status", c.plan_status || "");
      applyChip("plan_term", c.plan_term || "");

      lockAllChips();
      setStatus("");
    } catch(err){
      console.error("[TBP] client-dashboard load error:", err);
      setStatus(err?.message || "Failed to load dashboard", "err");
      if (hBusiness) hBusiness.textContent = "Failed to load";
      if (hContact) hContact.textContent = "";
      setPill("Wizard: Unknown", "neutral");
    }
  }

  if (btnOpenSecure) {
    btnOpenSecure.addEventListener("click", () => {
      location.href = "client-secure-dashboard.html";
    });
  }

  load();
</script>
</body>
</html>

</body>
</html>
