<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>TradeBotPro â€” Customers Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root{
  --primary-blue:#1f4e79;
  --accent-blue:#00a3ff;
  --dark-text:#151820;
  --muted-text:#6b7280;
  --border-subtle:rgba(15,23,42,0.12);
  --white:#ffffff;
  --danger-red:#b3261e;
  --amber:#b45309;
  --success:#0f7b46;
}
*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
  background:radial-gradient(circle at top left,#e0ebff 0,#f3f4f9 40%,#fdfdfd 100%);
  color:var(--dark-text);
}

header{
  background:#f8fafc;
  border-bottom:1px solid rgba(15,23,42,.08);
}
.header-inner{
  max-width:1200px;
  margin:0 auto;
  padding:.7rem 1.25rem;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.logo{font-weight:800;color:var(--primary-blue)}

main{
  max-width:1200px;
  margin:0 auto;
  padding:1.2rem;
}

.panel{
  background:#fff;
  border-radius:1.1rem;
  border:1px solid rgba(15,23,42,.08);
  padding:1.1rem;
}

.kicker{
  font-size:.72rem;
  letter-spacing:.12em;
  text-transform:uppercase;
  color:var(--accent-blue);
}
h1{
  margin:.15rem 0 .35rem;
  color:var(--primary-blue);
}
.subtitle{
  font-size:.9rem;
  color:var(--muted-text);
  margin-bottom:.9rem;
}

/* STATUS STRIP */
.status-strip{
  display:flex;
  gap:.55rem;
  flex-wrap:wrap;
  margin-bottom:.75rem;
}
.status-chip{
  padding:.45rem .8rem;
  border-radius:999px;
  border:1px solid rgba(15,23,42,.12);
  background:#fff;
  cursor:pointer;
  font-weight:650;
  font-size:.85rem;
}
.status-chip.is-active{
  background:#eef2ff;
  border-color:var(--primary-blue);
}

/* CONTROLS */
.controls{
  display:flex;
  align-items:center;
  gap:.6rem;
  margin:.8rem 0 .9rem;
  flex-wrap:nowrap;
}
.search{
  flex:1;
  display:flex;
  align-items:center;
  gap:.45rem;
  padding:.55rem .65rem;
  border:1px solid var(--border-subtle);
  border-radius:999px;
  background:#fff;
  min-width:320px;
}
.search input{
  border:0;
  outline:0;
  width:100%;
  font-size:.9rem;
  background:transparent;
}
.btn{
  padding:.5rem 1rem;
  border-radius:999px;
  border:1px solid transparent;
  cursor:pointer;
  font-weight:650;
  font-size:.85rem;
  white-space:nowrap;
}
.btn-secondary{
  background:#f3f4f6;
  border-color:var(--border-subtle);
}
.btn-primary{
  background:linear-gradient(135deg,var(--primary-blue),#163857);
  color:#fff;
}

@media(max-width:900px){
  .controls{flex-wrap:wrap}
  .search{order:10;width:100%;min-width:0}
}

/* TABLE */
.table-wrap{
  border-radius:.9rem;
  overflow:auto;
  border:1px solid rgba(15,23,42,.08);
}
table{
  width:100%;
  border-collapse:collapse;
  min-width:1100px;
}
th,td{
  padding:.65rem .75rem;
  border-bottom:1px solid rgba(15,23,42,.06);
  font-size:.9rem;
  white-space:nowrap;
}
th{
  background:#f8fafc;
  font-size:.75rem;
  text-transform:uppercase;
  letter-spacing:.1em;
  color:var(--muted-text);
}
tr:hover{
  background:#f7fbff;
  cursor:pointer;
}

/* BADGES */
.badge{
  padding:.2rem .55rem;
  border-radius:999px;
  font-size:.75rem;
  font-weight:750;
}
.badge.new{background:#eef2ff;color:var(--primary-blue)}
.badge.demo{background:#fffbeb;color:var(--amber)}
.badges{display:flex;gap:6px}

/* OPS DOTS */
.pipe{display:inline-flex;gap:6px}
.dot{
  width:10px;height:10px;border-radius:999px;
  border:2px solid rgba(148,163,184,.9);
  background:#fff;
}
.dot.done{background:#dcfce7;border-color:rgba(15,123,70,.55)}
.dot.need{background:#fff1f2;border-color:rgba(179,38,30,.35)}

/* =========================
   WIDE DRAWER (NO SLIDER)
   ========================= */
.drawer{
  position:fixed;
  top:0;
  right:-720px;
  width:720px;
  max-width:98vw;
  height:100%;
  background:#fff;
  box-shadow:-20px 0 40px rgba(0,0,0,.15);
  transition:right .22s ease;
  z-index:999;
  display:flex;
  flex-direction:column;
}
.drawer.open{right:0}

.drawer-header{
  padding:1rem;
  border-bottom:1px solid var(--border-subtle);
  background:#f8fafc;
}
.drawer-title{
  font-weight:800;
  color:var(--primary-blue);
}
.drawer-sub{
  font-size:.85rem;
  color:var(--muted-text);
}

.drawer-body{
  padding:1rem;
  flex:1;
  overflow-y:auto;
}

.drawer-footer{
  padding:1rem;
  border-top:1px solid var(--border-subtle);
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:.6rem;
}

.section-title{
  font-weight:800;
  color:var(--primary-blue);
  font-size:.9rem;
  margin:.8rem 0 .4rem;
}

.chip-row{display:flex;flex-wrap:wrap;gap:8px}
.chip{
  padding:.45rem .8rem;
  border-radius:999px;
  border:1px solid rgba(15,23,42,.12);
  background:#fff;
  cursor:pointer;
  font-weight:650;
}
.chip.is-active{
  background:#eef2ff;
  border-color:var(--primary-blue);
}

.checklist{
  border:1px solid rgba(15,23,42,.08);
  border-radius:.9rem;
  padding:.6rem;
}
.check-item{
  display:flex;
  justify-content:space-between;
  padding:.5rem 0;
  cursor:pointer;
}
.check-item:not(:last-child){
  border-bottom:1px dashed rgba(148,163,184,.5);
}

textarea{
  width:100%;
  min-height:120px;
  border-radius:.8rem;
  border:1px solid var(--border-subtle);
  padding:.6rem;
  font:inherit;
}
</style>
</head>

<body>
<header>
  <div class="header-inner">
    <div class="logo">TradeBotPro</div>
    <div style="font-size:.8rem;color:#6b7280;">Onboarding Dashboard</div>
  </div>
</header>

<main>
  <div class="panel">
    <div class="kicker">Customers</div>
    <h1>Customers by onboarding status (sales) + setup tasks (ops)</h1>
    <p class="subtitle">Click a row to open the side panel. Wizard opens only from the button.</p>

    <div class="status-strip" id="status-strip"></div>

    <div class="controls">
      <button class="btn btn-secondary" id="btn-clear">Clear filters</button>
      <div class="search">
        ðŸ”Ž <input id="search" placeholder="Search business, contact, emailâ€¦" />
      </div>
      <button class="btn btn-secondary" id="btn-refresh">â†» Refresh</button>
      <button class="btn btn-primary" id="btn-new">+ New customer</button>
    </div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Attention</th>
            <th>Status</th>
            <th>Setup</th>
            <th>Business</th>
            <th>Contact</th>
            <th>Email</th>
            <th>Phone</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>
</main>

<div class="drawer" id="drawer">
  <div class="drawer-header">
    <div class="drawer-title" id="dTitle"></div>
    <div class="drawer-sub" id="dSub"></div>
  </div>

  <div class="drawer-body">
    <div class="section-title">Sales stage</div>
    <div class="chip-row" id="salesChips"></div>

    <div class="section-title">Setup tasks</div>
    <div class="checklist" id="opsList"></div>

    <div class="section-title">Notes</div>
    <textarea id="notes"></textarea>
  </div>

  <div class="drawer-footer">
    <div style="font-size:.8rem;color:#6b7280;">Autosaves</div>
    <div>
      <button class="btn btn-secondary" id="btnWizard">Open wizard</button>
      <button class="btn btn-secondary" id="btnClose">Close</button>
    </div>
  </div>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const sb = createClient(
  "https://yaiutswdcbfwkxfqxkzy.supabase.co",
  "PASTE_YOUR_ANON_KEY"
);

const SALES = ["New Signup","In Setup","Demo","Free Trial","Needs Convincing","Live"];
let rows=[], active=null;

const tbody=document.getElementById("tbody");
const drawer=document.getElementById("drawer");

function render(){
  tbody.innerHTML="";
  rows.forEach(r=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${r.onboarding_status==="New Signup"?'<span class="badge new">New</span>':'â€”'}</td>
      <td>${r.onboarding_status||"New Signup"}</td>
      <td><span class="pipe">
        ${["wizard_completed","whatsapp_connected","calendar_connected","payments_connected"]
          .map(k=>`<span class="dot ${r[k]?"done":"need"}"></span>`).join("")}
      </span></td>
      <td>${r.business_name||"â€”"}</td>
      <td>${r.contact_name||"â€”"}</td>
      <td>${r.email||"â€”"}</td>
      <td>${r.phone||"â€”"}</td>
    `;
    tr.onclick=()=>openDrawer(r);
    tbody.appendChild(tr);
  });
}

function openDrawer(r){
  active=r;
  drawer.classList.add("open");
}

async function load(){
  const {data}=await sb.from("customers").select("*");
  rows=data||[];
  render();
}

document.getElementById("btnClose").onclick=()=>drawer.classList.remove("open");
document.getElementById("btnWizard").onclick=()=>window.open(`app.html?id=${active.id}`,"_blank");
document.getElementById("btnRefresh").onclick=load;
document.getElementById("btnNew").onclick=()=>window.open("app.html","_blank");

load();
</script>
</body>
</html>
