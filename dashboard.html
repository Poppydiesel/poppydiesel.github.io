<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>TradeBotPro â€” Customers Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root{
  --primary-blue:#1f4e79;
  --accent-blue:#00a3ff;
  --dark-text:#151820;
  --muted-text:#6b7280;
  --light-bg:#f3f4f9;
  --white:#ffffff;
  --border-subtle:rgba(15,23,42,0.12);
  --success-green:#0f7b46;
  --danger-red:#b3261e;
  --amber:#b45309;
}

/* ---------- BASE ---------- */
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
  background:radial-gradient(circle at top left,#e0ebff 0,#f3f4f9 40%,#fdfdfd 100%);
  color:var(--dark-text);
}
header{
  background:#f8fafc;
  border-bottom:1px solid rgba(15,23,42,.08);
}
.header-inner{
  max-width:1200px;
  margin:0 auto;
  padding:.7rem 1.25rem;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.logo{
  font-weight:800;
  color:var(--primary-blue);
}
main{
  max-width:1200px;
  margin:0 auto;
  padding:1.2rem;
}

/* ---------- PANEL ---------- */
.panel{
  background:#fff;
  border-radius:1.1rem;
  border:1px solid rgba(15,23,42,.08);
  padding:1.1rem;
}
.kicker{
  font-size:.72rem;
  letter-spacing:.12em;
  text-transform:uppercase;
  color:var(--accent-blue);
}
h1{
  margin:.15rem 0 .4rem;
  color:var(--primary-blue);
}
.subtitle{
  font-size:.9rem;
  color:var(--muted-text);
  margin-bottom:.9rem;
}

/* ---------- STATUS STRIP ---------- */
.status-strip{
  display:flex;
  gap:.55rem;
  flex-wrap:wrap;
  margin-bottom:.75rem;
}
.status-chip{
  padding:.45rem .8rem;
  border-radius:999px;
  border:1px solid rgba(15,23,42,.12);
  background:#fff;
  cursor:pointer;
  font-weight:600;
  font-size:.85rem;
}
.status-chip.is-active{
  background:#eef2ff;
  border-color:var(--primary-blue);
}

/* ---------- CONTROLS (ONE ROW) ---------- */
.controls{
  display:flex;
  align-items:center;
  gap:.6rem;
  margin:.8rem 0 .9rem;
}
.search{
  flex:1;
  display:flex;
  align-items:center;
  gap:.45rem;
  padding:.55rem .65rem;
  border:1px solid var(--border-subtle);
  border-radius:999px;
}
.search input{
  border:0;
  outline:0;
  width:100%;
  font-size:.9rem;
}
.btn{
  padding:.5rem 1rem;
  border-radius:999px;
  border:1px solid transparent;
  cursor:pointer;
  font-weight:600;
  font-size:.85rem;
}
.btn-secondary{
  background:#f3f4f6;
  border-color:var(--border-subtle);
}
.btn-primary{
  background:linear-gradient(135deg,var(--primary-blue),#163857);
  color:#fff;
}

/* ---------- TABLE ---------- */
.table-wrap{
  border-radius:.9rem;
  overflow:auto;
  border:1px solid rgba(15,23,42,.08);
}
table{
  width:100%;
  border-collapse:collapse;
  min-width:1000px;
}
th,td{
  padding:.65rem .75rem;
  border-bottom:1px solid rgba(15,23,42,.06);
  font-size:.9rem;
}
th{
  background:#f8fafc;
  font-size:.75rem;
  text-transform:uppercase;
  letter-spacing:.1em;
  color:var(--muted-text);
}
tr:hover{
  background:#f7fbff;
  cursor:pointer;
}

/* ---------- BADGES ---------- */
.badge{
  padding:.2rem .55rem;
  border-radius:999px;
  font-size:.75rem;
  font-weight:700;
}
.badge.new{background:#eef2ff;color:var(--primary-blue)}
.badge.overdue{background:#fff1f2;color:var(--danger-red)}
.badge.demo{background:#fffbeb;color:var(--amber)}

/* ---------- RESPONSIVE ---------- */
@media(max-width:900px){
  .controls{
    flex-wrap:wrap;
  }
  .search{
    order:10;
    width:100%;
  }
}
</style>
</head>

<body>

<header>
  <div class="header-inner">
    <div class="logo">TradeBotPro</div>
    <div style="font-size:.8rem;color:#6b7280;">Onboarding Dashboard</div>
  </div>
</header>

<main>
  <div class="panel">
    <div class="kicker">Customers</div>
    <h1>Customers by onboarding status (sales) + setup tasks (ops)</h1>
    <p class="subtitle">
      Filter by sales stage. Pipeline dots manage setup tasks only.
    </p>

    <!-- STATUS FILTERS -->
    <div class="status-strip" id="status-strip"></div>

    <!-- CONTROLS ROW -->
    <div class="controls">
      <button class="btn btn-secondary" id="btn-clear-filter">Clear filters</button>

      <div class="search">
        ðŸ”Ž
        <input id="search" placeholder="Search business, contact, email, phoneâ€¦" />
      </div>

      <button class="btn btn-secondary" id="btn-refresh">â†» Refresh</button>
      <button class="btn btn-primary" id="btn-new">+ New customer</button>
    </div>

    <!-- TABLE -->
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Attention</th>
            <th>Status</th>
            <th>Business</th>
            <th>Contact</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Updated</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div id="status-bar" style="margin-top:.6rem;font-size:.8rem;color:#6b7280"></div>
  </div>
</main>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const sb = createClient(
  "https://yaiutswdcbfwkxfqxkzy.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhaXV0c3dkY2Jmd2t4ZnF4a3p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDE2MDgsImV4cCI6MjA4MDA3NzYwOH0.HOLFxzjsZ5Ieqg0b-aTdP0hAdLsPVXL6Zjs-HgOHgc8"
);

const tbody = document.getElementById("tbody");
const statusStrip = document.getElementById("status-strip");
const search = document.getElementById("search");
const statusBar = document.getElementById("status-bar");

let rows = [];
let activeStatus = null;

const SALES = ["New Signup","In Setup","Demo","Free Trial","Needs Convincing","Live"];

function badge(row){
  if(row.onboarding_status === "Demo" && !row.wizard_completed)
    return `<span class="badge demo">Demo gap</span>`;
  if(row.onboarding_status === "New Signup")
    return `<span class="badge new">New</span>`;
  return "â€”";
}

function render(){
  tbody.innerHTML = "";
  const q = search.value.toLowerCase();

  const filtered = rows.filter(r=>{
    if(activeStatus && r.onboarding_status !== activeStatus) return false;
    if(q && !JSON.stringify(r).toLowerCase().includes(q)) return false;
    return true;
  });

  filtered.forEach(r=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${badge(r)}</td>
      <td>${r.onboarding_status}</td>
      <td>${r.business_name || "â€”"}</td>
      <td>${r.contact_name || "â€”"}</td>
      <td>${r.email || "â€”"}</td>
      <td>${r.phone || "â€”"}</td>
      <td>${new Date(r.updated_at).toLocaleString()}</td>
    `;
    tr.onclick = ()=>window.open(`app.html?id=${r.id}`,"_blank");
    tbody.appendChild(tr);
  });

  statusBar.textContent = `${filtered.length} shown â€¢ ${rows.length} total`;
}

function renderStatuses(){
  statusStrip.innerHTML = "";
  const allBtn = document.createElement("div");
  allBtn.className = "status-chip" + (activeStatus===null?" is-active":"");
  allBtn.textContent = "All";
  allBtn.onclick = ()=>{activeStatus=null;renderStatuses();render()};
  statusStrip.appendChild(allBtn);

  SALES.forEach(s=>{
    const btn = document.createElement("div");
    btn.className = "status-chip" + (activeStatus===s?" is-active":"");
    btn.textContent = s;
    btn.onclick = ()=>{activeStatus=s;renderStatuses();render()};
    statusStrip.appendChild(btn);
  });
}

async function load(){
  const { data } = await sb.from("customers").select("*");
  rows = data || [];
  renderStatuses();
  render();
}

document.getElementById("btn-refresh").onclick = load;
document.getElementById("btn-clear-filter").onclick = ()=>{
  activeStatus=null;
  search.value="";
  renderStatuses();
  render();
};
document.getElementById("btn-new").onclick = ()=>window.open("app.html","_blank");
search.oninput = render;

load();
</script>

</body>
</html>
