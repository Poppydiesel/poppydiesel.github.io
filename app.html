<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TradeBotPro — Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --primary-blue: #1f4e79;
      --accent-blue: #00a3ff;
      --dark-text: #1b1b1f;
      --light-bg: #f5f7fa;
      --white: #ffffff;
      --border: #dde2eb;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--light-bg);
      color: var(--dark-text);
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: var(--primary-blue);
      color: var(--white);
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    header .logo {
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    header .account-status {
      font-size: 14px;
      opacity: 0.9;
    }

    header .account-status span {
      font-weight: 600;
    }

    main {
      flex: 1;
      padding: 24px;
      max-width: 1100px;
      margin: 0 auto;
      width: 100%;
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.5fr);
      gap: 24px;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--white);
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 16px 18px;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
    }

    .card h2 {
      margin: 0 0 8px 0;
      font-size: 18px;
    }

    .card p.description {
      margin: 0 0 12px 0;
      font-size: 13px;
      color: #6b7280;
    }

    .details-list {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px 16px;
      font-size: 14px;
    }

    @media (max-width: 600px) {
      .details-list {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .details-list .label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: #6b7280;
      margin-bottom: 2px;
    }

    .details-list .value {
      font-weight: 500;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      border: 1px solid;
    }

    .badge.status {
      border-color: rgba(255, 255, 255, 0.8);
      background: rgba(255, 255, 255, 0.12);
      color: #e5f2ff;
    }

    .badge.error {
      border-color: #f97373;
      color: #b91c1c;
      background: #fee2e2;
    }

    .badge.ok {
      border-color: #4ade80;
      color: #166534;
      background: #dcfce7;
    }

    .status-text {
      font-size: 13px;
      margin-top: 6px;
      color: #4b5563;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .pill {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #f9fafb;
    }

    .section-title {
      font-size: 15px;
      font-weight: 600;
      margin: 16px 0 8px 0;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 10px;
    }

    .field-group label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #6b7280;
    }

    .field-group select,
    .field-group input {
      padding: 8px 10px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid var(--border);
      width: 100%;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .btn {
      border-radius: 999px;
      border: none;
      font-size: 14px;
      padding: 8px 16px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--primary-blue);
      color: var(--white);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }

    .helper-text {
      font-size: 12px;
      color: #6b7280;
      margin-top: 6px;
    }

    .error-message {
      margin-top: 10px;
      font-size: 13px;
      color: #b91c1c;
    }

    .info-message {
      margin-top: 10px;
      font-size: 13px;
      color: #374151;
    }

    .muted {
      opacity: 0.8;
    }

    .loading {
      font-size: 13px;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="logo">TradeBotPro</div>
      <div class="account-status">
        Account status:
        <span id="accountStatusTag">Loading…</span>
      </div>
    </header>

    <main>
      <div id="loadingGlobal" class="loading">Loading your dashboard…</div>
      <div id="errorGlobal" class="error-message" style="display:none;"></div>

      <div class="grid" id="dashboardGrid" style="display:none;">
        <!-- LEFT COLUMN: BUSINESS PROFILE -->
        <section class="card">
          <h2>Your business profile</h2>
          <p class="description">
            This is how TradeBotPro knows who you are and what you do. Later, this will power your public mini-website and map listing.
          </p>

          <div class="details-list">
            <div>
              <div class="label">Business name</div>
              <div class="value" id="businessName">–</div>
            </div>
            <div>
              <div class="label">Trade</div>
              <div class="value" id="tradeType">–</div>
            </div>
            <div>
              <div class="label">Contact name</div>
              <div class="value" id="contactName">–</div>
            </div>
            <div>
              <div class="label">Email</div>
              <div class="value" id="emailAddress">–</div>
            </div>
            <div>
              <div class="label">Phone</div>
              <div class="value" id="phoneNumber">–</div>
            </div>
            <div>
              <div class="label">Account status</div>
              <div class="value">
                <span id="accountStatusBadge" class="badge status">Checking…</span>
              </div>
            </div>
          </div>

          <div class="section-title">What TradeBotPro can do for you</div>
          <p class="status-text">
            Over time you’ll be able to tweak how your AI assistant answers questions so it matches your business, pricing and tone of voice.
          </p>

          <div class="pill-row">
            <div class="pill">Answer FAQs 24/7</div>
            <div class="pill">Capture leads & bookings</div>
            <div class="pill">Send quotes & invoices</div>
            <div class="pill">Chase payments</div>
          </div>

          <p class="helper-text">
            If something looks wrong here, message us and we’ll fix your profile behind the scenes while we build profile editing into the dashboard.
          </p>
        </section>

        <!-- RIGHT COLUMN: PRICING & ASSISTANT CONTROLS (V1 PLACEHOLDER) -->
        <section class="card">
          <h2>Assistant settings (coming soon)</h2>
          <p class="description">
            These controls will let you tune your assistant without needing any tech skills.
          </p>

          <div class="section-title">1. Call-out & job pricing</div>
          <div class="field-group">
            <label for="calloutPrice">Typical call-out fee</label>
            <input
              id="calloutPrice"
              type="text"
              placeholder="e.g. £80 + VAT"
              disabled
            />
          </div>

          <div class="field-group">
            <label for="pricingStyle">How should TradeBotPro talk about pricing?</label>
            <select id="pricingStyle" disabled>
              <option value="guide_only">Give guide prices only (never exact quotes)</option>
              <option value="from_prices">Use “from £X” ranges</option>
              <option value="no_prices">Never mention prices automatically</option>
            </select>
            <div class="helper-text">
              Whatever you choose here, our T&Cs make it clear that pricing is <strong>guidance only</strong> and the final decision is always yours.
            </div>
          </div>

          <div class="section-title">2. Your trade</div>
          <div class="field-group">
            <label for="tradeSelector">Main trade</label>
            <select id="tradeSelector" disabled>
              <!-- COMBINED TRADE LIST: FROM SUPABASE + EXTRA OPTIONS -->
              <!-- Core trades you told me are already in Supabase -->
              <option value="plumbing_heating">Plumbers &amp; Heating Engineers</option>
              <option value="roofing_guttering">Roofers &amp; Guttering</option>
              <option value="cleaning_carpets">Cleaners &amp; Carpet Cleaners</option>
              <option value="electrician">Electricians</option>
              <option value="pest_control">Pest Control</option>
              <option value="window_cleaner">Window Cleaners</option>
              <option value="landscaping_gardening">Landscapers &amp; Gardeners</option>
              <option value="home_repairs">Home Repairs &amp; Maintenance</option>
              <option value="builder_handyman">Builders &amp; Handymen</option>
              <option value="painting_decorating">Painters &amp; Decorators</option>

              <!-- Extra trades for future expansion -->
              <option value="gas_engineer">Gas Engineer</option>
              <option value="drainage">Drainage / Blockages</option>
              <option value="boiler_specialist">Boiler Specialist</option>
              <option value="bathroom_installer">Bathroom Installer</option>
              <option value="heat_pump">Heat Pump / Renewables</option>
              <option value="general_builder">General Builder</option>
              <option value="locksmith">Locksmith</option>
            </select>
            <div class="helper-text">
              In the next version you’ll be able to choose one or more trades here and your assistant will answer accordingly.
            </div>
          </div>

          <div class="section-title">3. Help us train your assistant</div>
          <p class="info-message">
            Soon you’ll be able to mark answers as “helpful” or “needs work”, and send us your own preferred wording.
            We’ll use this feedback to improve your assistant and our safety prompts — without you having to write any code.
          </p>

          <div class="btn-row">
            <button class="btn btn-primary" disabled>
              Save settings
            </button>
            <button class="btn btn-secondary" disabled>
              Request a change
            </button>
          </div>

          <div class="helper-text muted">
            For now, these controls are “read only” — they’re here to show you what’s coming and to prove your account is linked correctly.
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- Supabase JS -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <script>
    // 1. PUT YOUR REAL SUPABASE VALUES HERE
    const SUPABASE_URL = "https://yaiutswdcbfwkxfqxkzy.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhaXV0c3dkY2Jmd2t4ZnF4a3p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDE2MDgsImV4cCI6MjA4MDA3NzYwOH0.HOLFxzjsZ5Ieqg0b-aTdP0hAdLsPVXL6Zjs-HgOHgc8";

    // 2. Initialise Supabase client
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const $ = (id) => document.getElementById(id);

    async function loadDashboard() {
      const loadingGlobal = $("loadingGlobal");
      const errorGlobal = $("errorGlobal");
      const dashboardGrid = $("dashboardGrid");
      const accountStatusTag = $("accountStatusTag");
      const accountStatusBadge = $("accountStatusBadge");

      loadingGlobal.style.display = "block";
      errorGlobal.style.display = "none";
      dashboardGrid.style.display = "none";
      accountStatusTag.textContent = "Loading…";
      accountStatusBadge.textContent = "Checking…";

      // Get user_id from URL ?user_id=...
      const params = new URLSearchParams(window.location.search);
      const userId = params.get("user_id");

      if (!userId) {
        loadingGlobal.style.display = "none";
        errorGlobal.style.display = "block";
        errorGlobal.textContent =
          "Missing user_id in the URL. Ask Andy for your correct dashboard link.";
        accountStatusTag.textContent = "Error";
        accountStatusBadge.textContent = "Missing user_id";
        accountStatusBadge.classList.remove("status");
        accountStatusBadge.classList.add("error");
        return;
      }

      try {
        // 3. Load the record from business_profiles (NOT tradebotpro_signups)
        const { data, error } = await supabaseClient
          .from("business_profiles")
          .select(
            "id, business_name, contact_name, email, phone, trade_type, account_status"
          )
          .eq("id", userId)
          .single();

        if (error) {
          console.error("Supabase error:", error);
          throw error;
        }

        if (!data) {
          throw new Error("No profile found for this user_id.");
        }

        // 4. Populate the dashboard fields
        $("businessName").textContent = data.business_name || "Not set";
        $("contactName").textContent = data.contact_name || "Not set";
        $("emailAddress").textContent = data.email || "Not set";
        $("phoneNumber").textContent = data.phone || "Not set";
        $("tradeType").textContent = data.trade_type || "Not set";

        const statusText = data.account_status || "Trial";
        accountStatusTag.textContent = statusText;
        accountStatusBadge.textContent = statusText;

        accountStatusBadge.classList.remove("error");
        accountStatusBadge.classList.add("ok");

        loadingGlobal.style.display = "none";
        dashboardGrid.style.display = "grid";

      } catch (err) {
        console.error("Dashboard load failed:", err);
        loadingGlobal.style.display = "none";
        errorGlobal.style.display = "block";
        errorGlobal.textContent =
          "Could not load your details (Supabase error).";

        accountStatusTag.textContent = "Error";
        accountStatusBadge.textContent = "Error";
        accountStatusBadge.classList.remove("ok");
        accountStatusBadge.classList.add("error");
      }
    }

    document.addEventListener("DOMContentLoaded", loadDashboard);
  </script>
</body>
</html>
