
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TradeBotPro – Setup Wizard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="TradeBotPro setup wizard for new trade accounts." />

  <style>
    :root {
      --primary-blue: #1f4e79;
      --accent-blue: #00a3ff;
      --dark-text: #151820;
      --muted-text: #6b7280;
      --light-bg: #f3f4f9;
      --white: #ffffff;
      --border-subtle: rgba(15, 23, 42, 0.12);
      --success-green: #0f7b46;
      --error-red: #b3261e;
    }

    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: radial-gradient(circle at top left, #e0ebff 0, #f3f4f9 40%, #fdfdfd 100%);
      color: var(--dark-text);
      line-height: 1.5;
    }

    .page { min-height: 100vh; display: flex; flex-direction: column; }
    header { border-bottom: 1px solid rgba(15, 23, 42, 0.06); background: rgba(248, 250, 252, 0.96); position: sticky; top: 0; z-index: 20; }
    .header-inner { max-width: 1100px; margin: 0 auto; padding: 0.6rem 1.25rem; display: flex; align-items: center; justify-content: space-between; gap: 0.75rem; }
    .logo-main { font-weight: 700; font-size: 1rem; color: var(--primary-blue); }
    .logo-tag { font-size: 0.75rem; color: var(--muted-text); }
    .header-note { font-size: 0.75rem; color: var(--muted-text); }
    .header-note strong { color: var(--primary-blue); font-weight: 600; }

    main { flex: 1; display: flex; align-items: center; justify-content: center; padding: 2.5rem 1.25rem 3rem; }
    .wizard-shell { width: 100%; max-width: 1100px; display: grid; grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.4fr); gap: 1.75rem; align-items: flex-start; }

    .wizard-left, .wizard-right { padding: 1.5rem 1.6rem; border-radius: 1.2rem; }
    .wizard-left { background: rgba(255, 255, 255, 0.92); box-shadow: 0 24px 60px rgba(15, 23, 42, 0.15); }
    .wizard-right { background: rgba(248, 250, 252, 0.96); border: 1px solid rgba(148, 163, 184, 0.35); }

    .step-panel { display: none; margin-top: 0.9rem; }
    .step-panel.is-active { display: block; }

    .chip-row { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 0.25rem; margin-bottom: 14px; }
    .chip { display: inline-flex; align-items: center; justify-content: center; padding: 0.4rem 0.9rem; border-radius: 999px; border: 1px solid rgba(0, 0, 0, 0.12); background: #fff; font-size: 0.85rem; cursor: pointer; }
    .chip:hover { border-color: #1f4e79; background: rgba(31, 78, 121, 0.06); }
    .chip.is-selected { outline: 2px solid rgba(31, 78, 121, 0.45); background: rgba(31, 78, 121, 0.08); border-color: #1f4e79; color: #1f4e79; font-weight: 600; }

    .wizard-footer { margin-top: 1.1rem; display: flex; justify-content: space-between; gap: 0.75rem; flex-wrap: wrap; border-top: 1px dashed rgba(148, 163, 184, 0.7); padding-top: 0.8rem; }
    .btn { border-radius: 999px; padding: 0.55rem 1.1rem; font-size: 0.86rem; font-weight: 500; cursor: pointer; }
    .btn-primary { background: linear-gradient(135deg, var(--primary-blue), #163857); color: #fff; }
    .btn-secondary { background: #f9fafb; border: 1px solid var(--border-subtle); }
    .wizard-status-message { margin-top: 0.7rem; font-size: 0.8rem; min-height: 1.2em; }
    .wizard-status-message--success { color: var(--success-green); }
    .wizard-status-message--error { color: var(--error-red); }
  </style>
</head>

<body>
<div class="page">
  <!-- HEADER -->
  <header>
    <div class="header-inner">
      <div>
        <div class="logo-main">TradeBotPro</div>
        <div class="logo-tag">More jobs. Less admin. Powered by AI.</div>
      </div>
      <div class="header-note">Goal: make you <strong>wish you had signed up years ago</strong> in the first month.</div>
    </div>
  </header>

  <!-- MAIN -->
  <main>
    <div class="wizard-shell">
      <!-- LEFT PANEL -->
      <aside class="wizard-left">
        <h1 class="wizard-title">Let’s tune TradeBotPro to your business</h1>
        <p class="wizard-subtitle">This takes around 5–10 minutes. Your answers help us configure how TradeBotPro works for you.</p>
        <div class="wizard-note"><strong>Important:</strong> Nothing goes live until you approve it.</div>
      </aside

      <!-- RIGHT PANEL -->
      <section class="wizard-right" aria-live="polite">
        <div id="wizard-step-label" class="wizard-step-label">Step 1</div>
        <h2 id="wizard-step-title" class="wizard-step-title">Business basics</h2>
        <p id="wizard-step-subtitle" class="wizard-step-subtitle">Who are you and what do you do?</p>

        <!-- Step 1 -->
        <div class="step-panel is-active" data-step="1">
          <div class="field-group">
            <label for="contact_name">Main contact name</label>
            <input id="contact_name" name="contact_name" type="text" autocomplete="name" />
          </div>
          <div class="field-group">
            <label for="business_name">Business name</label>
            <input id="business_name" name="business_name" type="text" placeholder="Business name" />
          </div>
          <div class="field-group">
            <label>What trade are you?</label>
            <div class="chip-row" data-field="main_trade" data-select="single">
              <button class="chip">Plumbing & Heating</button>
              <button class="chip">Heating only</button>
              <button class="chip">Gas engineer</button>
              <button class="chip">Electrician</button>
              <button class="chip">Roofing & guttering</button>
              <button class="chip">Landscaping / gardening</button>
              <button class="chip">Window cleaning</button>
              <button class="chip">Cleaning / carpet cleaning</button>
              <button class="chip">Builder</button>
              <button class="chip">Handyman</button>
              <button class="chip">Pest control</button>
              <button class="chip">Home repairs & maintenance</button>
              <button class="chip">Other</button>
            </div>
          </div>
          <div class="field-group">
            <label>Where are you as a business?</label>
            <div class="chip-row" data-field="business_stage" data-select="single">
              <button class="chip">Already trading</button>
              <button class="chip">Launching in next 3 months</button>
              <button class="chip">Just exploring options</button>
            </div>
          </div>
          <input id="contact_email" name="email" type="email" placeholder="Email" />
          <input id="contact_mobile" name="phone" type="tel" placeholder="Mobile / WhatsApp" />
        </div>

        <!-- Step 2 -->
        <div class="step-panel" data-step="2">
          <input id="base_postcode" name="base_postcode" type="text" placeholder="Base postcode" />
          <div class="chip-row" data-field="coverage_radius" data-select="single">
            <button class="chip">Just my town / city</button>
            <button class="chip">Up to ~10 miles from base</button>
            <button class="chip">Up to ~20 miles from base</button>
            <button class="chip">City-wide / multiple postcodes</button>
            <button class="chip">Custom list (we’ll import later)</button>
          </div>
          <div class="chip-row" data-field="callout_style" data-select="single">
            <button class="chip">Free estimates (no call-out fee)</button>
            <button class="chip">Paid call-out, deducted from job</button>
            <button class="chip">Fixed call-out fee</button>
            <button class="chip">No emergency call-outs</button>
          </div>
          <div class="chip-row" data-field="callout_band" data-select="single">
            <button class="chip">Up to £79</button>
            <button class="chip">£80–£119</button>
            <button class="chip">£120–£179</button>
            <button class="chip">£180+</button>
            <button class="chip">Varies – discuss with us</button>
          </div>
          <div class="chip-row" data-field="preferred_jobs" data-select="multi">
            <button class="chip">Emergency / urgent jobs</button>
            <button class="chip">Small jobs / quick wins</button>
            <button class="chip">Bigger projects / installs</button>
            <button class="chip">Maintenance / servicing</button>
            <button class="chip">Landlords / repeat clients</button>
          </div>
        </div>

        <!-- Step 3 -->
        <div class="step-panel" data-step="3">
          <div class="chip-row" data-field="tone_of_voice" data-select="single">
            <button class="chip">Friendly & informal</button>
            <button class="chip">Professional & straight to the point</button>
            <button class="chip">Premium / high-end feel</button>
            <button class="chip">Very short & efficient</button>
            <button class="chip">We’ll decide together</button>
          </div>
          <div class="chip-row" data-field="channels" data-select="multi">
            <button class="chip">WhatsApp</button>
            <button class="chip">SMS / text messages</button>
            <button class="chip">Facebook Messenger</button>
            <button class="chip">Website chat widget</button>
            <button class="chip">Instagram DMs</button>
          </div>
          <div class="chip-row" data-field="review_platforms" data-select="multi">
            <button class="chip">Google Reviews</button>
            <button class="chip">Trustpilot</button>
            <button class="chip">Facebook page reviews</button>
            <button class="chip">Yell / similar directories</button>
            <button class="chip">Checkatrade / trade portals</button>
          </div>
          <input id="review_link" name="review_link" type="text" placeholder="Paste your main review link" />
          <div class="chip-row" data-field="review_push_level" data-select="single">
            <button class="chip">Very gentle reminder only</button>
            <button class="chip">Standard follow-up & one reminder</button>
            <button class="chip">Quite proactive (several reminders)</button>
          </div>
          <textarea id="ai_avoid" name="ai_avoid" placeholder="Anything you never want the AI to say?"></textarea>
        </div>

        <!-- Step 4 -->
        <div class="step-panel" data-step="4">
          <div class="chip-row" data-field="demo_style" data-select="multi">
            <button class="chip">Test from our own phones first</button>
            <button class="chip">Test with a few real customers</button>
            <button class="chip">Test calendar bookings</button>
            <button class="chip">Test review follow-up flow</button>
          </div>
          <div class="chip-row" data-field="demo_slot" data-select="single">
            <button class="chip">Weekday – 6–8pm</button>
            <button class="chip">Weekday – 8–10pm</button>
            <button class="chip">Weekend evening</button>
            <button class="chip">Daytime (I’m flexible)</button>
          </div>
          <div class="chip-row" data-field="golive_timing" data-select="single">
            <button class="chip">Within 1 week of the demo</button>
            <button class="chip">Within 1 month</button>
            <button class="chip">Later – just getting ready</button>
          </div>
          <textarea id="extra_notes" name="extra_notes" placeholder="Anything else we should know?"></textarea>
          <div class="summary-box" id="summary-box" hidden>
            <strong>Nice work – wizard complete!</strong>
          </div>
        </div>

        <!-- Footer -->
        <div class="wizard-footer">
          <button id="btn-save-draft" class="btn btn-secondary">Save draft</button>
          <button id="btn-back" class="btn btn-secondary" disabled>← Back</button>
          <button id="btn-next" class="btn btn-primary">Next step →</button>
          <button id="btn-dashboard" class="btn btn-primary" style="display:none">Back to dashboard →</button>
        </div>
               <div id="wizard-status-message" class="wizard-status-message"></div>
      </section>
    </div>
  </main>
  
<!-- Supabase UMD -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.48.0/dist/umd/supabase.min.js"></script>

<script>
(function () {
  const SUPABASE_URL = "https://yaiutswdcbfwkxfqxkzy.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhaXV0c3dkY2Jmd2t4ZnF4a3p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDE2MDgsImV4cCI6MjA4MDA3NzYwOH0.HOLFxzjsZ5Ieqg0b-aTdP0hAdLsPVXL6Zjs-HgOHgc8";
  const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const panels = Array.from(document.querySelectorAll(".step-panel"));
  const btnBack = document.getElementById("btn-back");
  const btnNext = document.getElementById("btn-next");
  const btnDashboard = document.getElementById("btn-dashboard");
  const btnSaveDraft = document.getElementById("btn-save-draft");
  const statusEl = document.getElementById("wizard-status-message");
  const summaryBoxEl = document.getElementById("summary-box");

  let currentStep = 1;
  const totalSteps = panels.length;
  const answers = {};

  function setStatus(msg, type) {
    statusEl.textContent = msg || "";
    statusEl.className = "wizard-status-message" + (type ? ` wizard-status-message--${type}` : "");
  }

  function renderStep() {
    panels.forEach(p => p.classList.remove("is-active"));
    const active = document.querySelector(`.step-panel[data-step="${currentStep}"]`);
    if (active) active.classList.add("is-active");
    btnBack.disabled = currentStep === 1;
    btnNext.textContent = currentStep === totalSteps ? "Finish →" : "Next step →";
  }

  function readInputs() {
    answers.contact_name = document.getElementById("contact_name")?.value.trim();
    answers.business_name = document.getElementById("business_name")?.value.trim();
    answers.contact_email = document.getElementById("contact_email")?.value.trim();
    answers.contact_mobile = document.getElementById("contact_mobile")?.value.trim();
    answers.base_postcode = document.getElementById("base_postcode")?.value.trim();
    answers.review_link = document.getElementById("review_link")?.value.trim();
    answers.ai_avoid = document.getElementById("ai_avoid")?.value.trim();
    answers.extra_notes = document.getElementById("extra_notes")?.value.trim();
  }

  function applyChipVisuals() {
    document.querySelectorAll(".chip-row").forEach(row => {
      const field = row.dataset.field;
      const mode = row.dataset.select;
      row.querySelectorAll(".chip").forEach(chip => {
        const label = chip.textContent.trim();
        let selected = false;
        if (mode === "single") selected = answers[field] === label;
        else selected = Array.isArray(answers[field]) && answers[field].includes(label);
        chip.classList.toggle("is-selected", selected);
        chip.setAttribute("aria-pressed", selected ? "true" : "false");
      });
    });
  }

  document.addEventListener("click", e => {
    const chip = e.target.closest(".chip");
    if (!chip) return;
    const row = chip.closest(".chip-row");
    const field = row.dataset.field;
    const mode = row.dataset.select;
    const label = chip.textContent.trim();
    if (mode === "single") {
      answers[field] = label;
    } else {
      if (!Array.isArray(answers[field])) answers[field] = [];
      const idx = answers[field].indexOf(label);
      if (idx >= 0) answers[field].splice(idx, 1);
      else answers[field].push(label);
    }
    applyChipVisuals();
  });

  btnSaveDraft.addEventListener("click", () => {
    readInputs();
    localStorage.setItem("tbp_wizard_draft", JSON.stringify({ answers, ts: Date.now() }));
    setStatus("Draft saved in this browser.", "success");
  });

  btnBack.addEventListener("click", () => {
    if (currentStep > 1) currentStep--; renderStep();
  });

  btnNext.addEventListener("click", async () => {
    readInputs();
    if (currentStep < totalSteps) {
      currentStep++; renderStep(); return;
    }
    btnNext.disabled = true; setStatus("Saving…");
    try {
      const patch = { wizard_answers: answers, wizard_completed: true, wizard_completed_at: new Date().toISOString() };
      await sb.from("customers").update(patch);
      setStatus("Saved. Wizard complete ✅", "success");
      summaryBoxEl.hidden = false;
      btnNext.style.display = "none"; btnDashboard.style.display = "inline-flex";
    } catch (err) {
      console.error(err); setStatus("Couldn’t save right now.", "error"); btnNext.disabled = false;
    }
  });

  btnDashboard.addEventListener("click", () => window.location.href = "/client-dashboard.html");

  renderStep();
})();
</script>

</body>

