<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TradeBotPro — Tell us about your business</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --primary-blue: #1f4e79;
      --accent-blue: #00a3ff;
      --dark-text: #1b1b1f;
      --light-bg: #f5f7fa;
      --white: #ffffff;
      --muted: #d0d7e2;
      --error: #c0392b;
      --success: #27ae60;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--light-bg);
      color: var(--dark-text);
    }

    .page {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .card {
      background: var(--white);
      max-width: 720px;
      width: 100%;
      border-radius: 16px;
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.08);
      padding: 24px 24px 28px;
    }

    @media (min-width: 768px) {
      .card {
        padding: 32px 36px 36px;
      }
    }

    .logo-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 16px;
    }

    .logo {
      font-weight: 700;
      font-size: 1.4rem;
      color: var(--primary-blue);
    }

    .tagline {
      font-size: 0.9rem;
      color: #5b6678;
      text-align: right;
    }

    h1 {
      margin: 0 0 8px;
      font-size: 1.6rem;
    }

    .subtitle {
      margin: 0 0 24px;
      color: #5b6678;
      font-size: 0.95rem;
    }

    /* Progress bar */
    .progress {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 24px;
    }

    .progress-label {
      font-size: 0.85rem;
      color: #5b6678;
      white-space: nowrap;
    }

    .progress-track {
      flex: 1;
      height: 8px;
      background: #e1e6f0;
      border-radius: 999px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--primary-blue), var(--accent-blue));
      transition: width 0.25s ease;
    }

    .progress-steps {
      display: flex;
      justify-content: space-between;
      margin-top: 6px;
      font-size: 0.75rem;
      color: #8a93a4;
    }

    .progress-step {
      position: relative;
      padding-top: 8px;
    }

    .progress-step::before {
      content: attr(data-step);
      position: absolute;
      top: -16px;
      left: 50%;
      transform: translateX(-50%);
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 2px solid #c8d0e0;
      background: #f6f7fb;
      font-size: 0.6rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #8a93a4;
    }

    .progress-step.active::before,
    .progress-step.completed::before {
      border-color: var(--primary-blue);
      background: var(--primary-blue);
      color: #ffffff;
    }

    .progress-step.completed {
      color: #5b6678;
    }

    .progress-step.active {
      color: var(--primary-blue);
      font-weight: 600;
    }

    .step-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .step-caption {
      font-size: 0.9rem;
      color: #5b6678;
      margin-bottom: 18px;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .field-row {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    @media (min-width: 720px) {
      .field-row {
        flex-direction: row;
      }
      .field {
        flex: 1;
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    label {
      font-size: 0.9rem;
      font-weight: 500;
    }

    label span.hint {
      font-weight: 400;
      color: #8a93a4;
      font-size: 0.8rem;
      margin-left: 4px;
    }

    input[type="text"],
    input[type="email"],
    textarea,
    select {
      padding: 9px 11px;
      border-radius: 8px;
      border: 1px solid #c8d0e0;
      font-size: 0.9rem;
      font-family: inherit;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
      background: #fdfdff;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 1px rgba(31, 78, 121, 0.18);
      background: #ffffff;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-family: inherit;
    }

    .btn-primary {
      background: var(--primary-blue);
      color: #ffffff;
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .btn-secondary {
      background: transparent;
      color: var(--primary-blue);
    }

    .note {
      font-size: 0.8rem;
      color: #8a93a4;
    }

    .status-message {
      margin-top: 10px;
      font-size: 0.9rem;
    }

    .status-message.error {
      color: var(--error);
    }

    .status-message.success {
      color: var(--success);
    }

    .hidden {
      display: none !important;
    }

    .text-right {
      text-align: right;
    }

    .small {
      font-size: 0.8rem;
      color: #8a93a4;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #eef3fb;
      font-size: 0.75rem;
      color: #4a5a73;
    }
  </style>
</head>
<body>
  <nav class="tbp-nav">
  <a href="./index.html">Home</a>
  <a href="./signup.html">Sign up</a>
  <a href="./login.html">Admin login</a>
</nav>

<style>
  .tbp-nav {
    display: flex;
    gap: 14px;
    padding: 10px 16px;
    font-size: 14px;
  }
  .tbp-nav a {
    text-decoration: none;
    font-weight: 600;
  }
</style>

  <div class="page">
    <div class="card">
      <div class="logo-row">
        <div class="logo">TradeBotPro</div>
        <div class="tagline">
          More jobs. Less admin.<br />
          <span class="small">Your 24/7 AI office for trades.</span>
        </div>
      </div>

      <h1>Tell us about your business</h1>
      <p class="subtitle">
        This helps your AI assistant sound like <strong>you</strong> and quote your work correctly.
        It takes about <strong>2 minutes</strong>.
      </p>

      <!-- Progress bar -->
      <div class="progress">
        <div class="progress-label">
          <span id="progress-text">Step 1 of 3</span>
        </div>
        <div class="progress-track">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
      </div>
      <div class="progress-steps">
        <div class="progress-step active" data-step="1">You & contact</div>
        <div class="progress-step" data-step="2">Business details</div>
        <div class="progress-step" data-step="3">Confirmation</div>
      </div>

      <!-- STEP CONTENT -->
      <div id="step-1">
        <div class="step-title">First, who should we contact?</div>
        <div class="step-caption">
          We’ll send setup details and test conversations to this person.
        </div>

        <form id="signup-form-step-1">
          <div class="field-row">
            <div class="field">
              <label for="contact_name">Your name</label>
              <input type="text" id="contact_name" name="contact_name" autocomplete="name" required />
            </div>
            <div class="field">
              <label for="email">Best email</label>
              <input type="email" id="email" name="email" autocomplete="email" required />
            </div>
          </div>

          <div class="field-row">
            <div class="field">
              <label for="phone">Mobile or phone</label>
              <input type="text" id="phone" name="phone" autocomplete="tel" />
            </div>
            <div class="field">
              <label for="whatsapp_number">
                WhatsApp number
                <span class="hint">(if different)</span>
              </label>
              <input type="text" id="whatsapp_number" name="whatsapp_number" />
            </div>
          </div>

          <div class="actions">
            <span class="note">You can change these later in your dashboard.</span>
            <button type="button" class="btn btn-primary" id="btn-next-1">
              Next: business details →
            </button>
          </div>
        </form>
      </div>

      <div id="step-2" class="hidden">
        <div class="step-title">Now tell us about the business</div>
        <div class="step-caption">
          A few basics so we can answer customers in your tone of voice.
        </div>

        <form id="signup-form-step-2">
          <div class="field-row">
            <div class="field">
              <label for="business_name">Business name</label>
              <input type="text" id="business_name" name="business_name" required />
            </div>
            <div class="field">
              <label for="trade_type">Trade</label>
              <select id="trade_type" name="trade_type" required>
                <option value="">Select trade…</option>
                <option value="Plumbing & Heating">Plumbing &amp; Heating</option>
                <option value="Gas Engineer">Gas engineer</option>
                <option value="Electrical">Electrical</option>
                <option value="Roofing">Roofing</option>
                <option value="Landscaping">Landscaping</option>
                <option value="General Building">General building</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>

          <div class="field-row">
            <div class="field">
              <label for="base_postcode">
                Base postcode
                <span class="hint">e.g. HP14 3QF</span>
              </label>
              <input type="text" id="base_postcode" name="base_postcode" />
            </div>
            <div class="field">
              <label for="website_url">
                Website
                <span class="hint">(if you have one)</span>
              </label>
              <input type="text" id="website_url" name="website_url" />
            </div>
          </div>

          <div class="field">
            <label for="notes">
              Anything we should know?
              <span class="hint">(tone of voice, jobs you prefer, jobs to avoid…)</span>
            </label>
            <textarea id="notes" name="notes"></textarea>
          </div>

          <div class="actions">
            <button type="button" class="btn btn-secondary" id="btn-back-2">← Back</button>
            <div class="text-right">
              <div class="pill">
                <span>Almost done</span> · <span>Next: confirmation</span>
              </div>
              <button type="button" class="btn btn-primary" id="btn-next-2">
                Continue →
              </button>
            </div>
          </div>
        </form>
      </div>

      <div id="step-3" class="hidden">
        <div class="step-title">Review & send</div>
        <div class="step-caption">
          We’ll use this info to set up your TradeBotPro assistant and share an onboarding link.
        </div>

        <div id="review-block" style="margin-bottom: 18px; font-size: 0.9rem; line-height: 1.5;">
          <!-- Filled by JS -->
        </div>

        <form id="signup-form-final">
          <div class="field">
            <label>
              <input type="checkbox" id="agree_terms" required />
              <span> I’m happy for TradeBotPro to contact me about setting up my AI assistant. </span>
            </label>
          </div>

          <div class="actions">
            <button type="button" class="btn btn-secondary" id="btn-back-3">← Back</button>
            <div class="text-right">
              <button type="submit" class="btn btn-primary" id="btn-submit">
                Start my setup
              </button>
              <div class="small">No spam. No commitment. Just a setup call and test assistant.</div>
            </div>
          </div>

          <div id="status" class="status-message"></div>
        </form>
      </div>
    </div>
  </div>

  <!-- Supabase + JS -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2.48.0";

    // TODO: replace with your real values
    const SUPABASE_URL = "https://yaiutswdcbfwkxfqxkzy.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlhaXV0c3dkY2Jmd2t4ZnF4a3p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1MDE2MDgsImV4cCI6MjA4MDA3NzYwOH0.HOLFxzjsZ5Ieqg0b-aTdP0hAdLsPVXL6Zjs-HgOHgc8";

    if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
      console.error("Missing SUPABASE_URL or SUPABASE_ANON_KEY");
    }

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Simple form state
    const state = {
      contact_name: "",
      email: "",
      phone: "",
      whatsapp_number: "",
      business_name: "",
      trade_type: "",
      base_postcode: "",
      website_url: "",
      notes: ""
    };

    const progressFill = document.getElementById("progress-fill");
    const progressText = document.getElementById("progress-text");
    const step1El = document.getElementById("step-1");
    const step2El = document.getElementById("step-2");
    const step3El = document.getElementById("step-3");
    const statusEl = document.getElementById("status");
    const reviewBlock = document.getElementById("review-block");
    const submitBtn = document.getElementById("btn-submit");

    const steps = {
      1: step1El,
      2: step2El,
      3: step3El
    };

    let currentStep = 1;

    function setStep(step) {
      currentStep = step;
      // Show/hide content
      Object.entries(steps).forEach(([num, el]) => {
        if (Number(num) === step) {
          el.classList.remove("hidden");
        } else {
          el.classList.add("hidden");
        }
      });

      // Progress fill (33, 66, 100)
      const pct = step === 1 ? 33 : step === 2 ? 66 : 100;
      progressFill.style.width = pct + "%";
      progressText.textContent = `Step ${step} of 3`;

      // Step labels
      document.querySelectorAll(".progress-step").forEach((el) => {
        const s = Number(el.getAttribute("data-step"));
        el.classList.remove("active", "completed");
        if (s < step) {
          el.classList.add("completed");
        } else if (s === step) {
          el.classList.add("active");
        }
      });

      if (step === 3) {
        renderReview();
      }
    }

    function renderReview() {
      reviewBlock.innerHTML = `
        <strong>Contact</strong><br />
        ${state.contact_name || "-"}<br />
        ${state.email || "-"}<br />
        ${state.phone || ""}${state.phone && state.whatsapp_number ? " · " : ""}${state.whatsapp_number || ""}<br /><br />

        <strong>Business</strong><br />
        ${state.business_name || "-"}<br />
        ${state.trade_type || "-"}<br />
        ${state.base_postcode || ""}<br />
        ${state.website_url || ""}<br /><br />

        <strong>Notes</strong><br />
        ${state.notes ? state.notes.replace(/\n/g, "<br />") : "No extra notes yet."}
      `;
    }

    function captureStep1() {
      state.contact_name = document.getElementById("contact_name").value.trim();
      state.email = document.getElementById("email").value.trim();
      state.phone = document.getElementById("phone").value.trim();
      state.whatsapp_number = document.getElementById("whatsapp_number").value.trim();
    }

    function captureStep2() {
      state.business_name = document.getElementById("business_name").value.trim();
      state.trade_type = document.getElementById("trade_type").value;
      state.base_postcode = document.getElementById("base_postcode").value.trim();
      state.website_url = document.getElementById("website_url").value.trim();
      state.notes = document.getElementById("notes").value.trim();
    }

    // Buttons
    document.getElementById("btn-next-1").addEventListener("click", () => {
      captureStep1();
      if (!state.contact_name || !state.email) {
        alert("Please add at least your name and email.");
        return;
      }
      setStep(2);
    });

    document.getElementById("btn-next-2").addEventListener("click", () => {
      captureStep2();
      if (!state.business_name || !state.trade_type) {
        alert("Please add your business name and trade.");
        return;
      }
      setStep(3);
    });

    document.getElementById("btn-back-2").addEventListener("click", () => {
      setStep(1);
    });

    document.getElementById("btn-back-3").addEventListener("click", () => {
      setStep(2);
    });

    // Final submit: send to Supabase
    document.getElementById("signup-form-final").addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.textContent = "";
      statusEl.className = "status-message";

      if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
        statusEl.textContent = "Supabase not configured on this page.";
        statusEl.classList.add("error");
        return;
      }

      captureStep1();
      captureStep2();

      if (!document.getElementById("agree_terms").checked) {
        statusEl.textContent = "Please confirm you’re happy for us to contact you.";
        statusEl.classList.add("error");
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = "Sending…";

      const payload = {
        contact_name: state.contact_name,
        email: state.email,
        phone: state.phone || null,
        whatsapp_number: state.whatsapp_number || null,
        business_name: state.business_name || null,
        trade_type: state.trade_type || null,
        base_postcode: state.base_postcode || null,
        website_url: state.website_url || null,
        notes: state.notes || null,
        source: "Website",
        plan_status: "New enquiry"
      };

      console.log("Sending to Supabase:", payload);

      const { data, error } = await supabase
        .from("tradebotpro_signups")
        .insert([payload])
        .select();

      console.log("Supabase response:", { data, error });

      if (error) {
        statusEl.textContent = "Something went wrong saving your details. Please try again or email hello@tradebotpro.co.uk.";
        statusEl.classList.add("error");
        submitBtn.disabled = false;
        submitBtn.textContent = "Start my setup";
        return;
      }

      statusEl.textContent = "Thanks — your details are saved. We’ll be in touch to set up your assistant.";
      statusEl.classList.add("success");

      // Optional: lock the form
      submitBtn.disabled = true;
      submitBtn.textContent = "Saved ✔";
    });

    // Start at step 1
    setStep(1);
  </script>
</body>
</html>
